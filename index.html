<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>對戰模式第二季 • 執法對決 SEASON 2 | Cyber Attack Simulation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== 基礎重置 ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', 'Consolas', 'Monaco', monospace;
        }

        body {
            background: #000;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            background: radial-gradient(ellipse at center, #0a0a0a 0%, #000000 100%);
        }

        /* ===== 屏幕效果 ===== */
        .screen-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .scanlines {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 100, 255, 0.03) 50%
            );
            background-size: 100% 4px;
        }

        /* ===== 頁面管理 ===== */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            transition: opacity 0.3s ease;
            display: none;
        }

        .page.active {
            display: block;
            opacity: 1;
            position: relative;
            z-index: 2;
        }

        .page.hidden {
            display: none;
            opacity: 0;
        }

        /* ===== 導航欄樣式 ===== */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.95), rgba(10, 10, 30, 0.95));
            border-bottom: 2px solid rgba(0, 100, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(0, 100, 255, 0.2);
        }

        .nav-logo {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4a90d9;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(74, 144, 217, 0.5);
        }

        .nav-logo:hover {
            filter: drop-shadow(0 0 15px rgba(74, 144, 217, 0.7));
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-menu li a {
            color: #aaa;
            text-decoration: none;
            font-size: 0.95rem;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 4px;
        }

        .nav-menu li a:hover {
            color: #4a90d9;
            background: rgba(74, 144, 217, 0.1);
            box-shadow: 0 0 10px rgba(74, 144, 217, 0.3);
        }

        .nav-menu li a.active {
            color: #4a90d9;
            border-bottom: 2px solid #4a90d9;
        }

        /* ===== 主頁面樣式 ===== */
        #main-page {
            background: linear-gradient(135deg, #0a0a1a 0%, #050510 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px 40px;
        }

        .main-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .season-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff9900 0%, #ff6600 100%);
            color: #000;
            font-weight: bold;
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            letter-spacing: 1px;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.5);
            text-transform: uppercase;
        }

        .main-logo {
            font-size: 3.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #4a90d9 0%, #357abd 25%, #6ab0ff 50%, #4a90d9 75%, #7bbfff 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(74, 144, 217, 0.6), 0 0 40px rgba(74, 144, 217, 0.3);
            margin-bottom: 20px;
            letter-spacing: 4px;
            animation: logoShine 4s ease-in-out infinite;
            text-align: center;
            filter: drop-shadow(0 0 25px rgba(74, 144, 217, 0.5));
        }

        @keyframes logoShine {
            0%, 100% {
                background-position: 0% 50%;
                filter: drop-shadow(0 0 25px rgba(74, 144, 217, 0.5));
            }
            50% {
                background-position: 100% 50%;
                filter: drop-shadow(0 0 40px rgba(74, 144, 217, 0.7));
            }
        }

        .main-subtitle {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 10px;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-align: center;
        }

        .main-tagline {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto 40px;
            text-align: center;
        }

        /* ===== 模式選擇 ===== */
        .mode-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            padding: 0 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .mode-selection {
                grid-template-columns: 1fr;
                max-width: 500px;
            }
        }

        .mode-card {
            background: rgba(25, 25, 40, 0.95);
            border-radius: 15px;
            padding: 35px 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
        }

        .mode-card.hacker {
            border-color: #00ff41;
            box-shadow: 0 0 25px rgba(0, 255, 65, 0.2);
        }

        .mode-card.hacker:hover {
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.4);
        }

        .mode-card.law-enforcement {
            border-color: #4a90d9;
            box-shadow: 0 0 25px rgba(74, 144, 217, 0.2);
        }

        .mode-card.law-enforcement:hover {
            box-shadow: 0 0 40px rgba(74, 144, 217, 0.4);
        }

        .mode-icon {
            font-size: 3.5rem;
            margin-bottom: 25px;
            text-align: center;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mode-card.hacker .mode-icon {
            color: #00ff41;
        }

        .mode-card.law-enforcement .mode-icon {
            color: #4a90d9;
        }

        .mode-title {
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .mode-card.hacker .mode-title {
            color: #00ff41;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        .mode-card.law-enforcement .mode-title {
            color: #4a90d9;
            text-shadow: 0 0 10px rgba(74, 144, 217, 0.5);
        }

        .mode-description {
            color: #bbb;
            line-height: 1.7;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.05rem;
        }

        .mode-features {
            list-style: none;
            margin-bottom: 30px;
        }

        .mode-features li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            padding-left: 30px;
            display: flex;
            align-items: center;
        }

        .mode-features li:before {
            content: "⟩";
            position: absolute;
            left: 0;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .mode-card.hacker .mode-features li:before {
            color: #00ff41;
        }

        .mode-card.law-enforcement .mode-features li:before {
            color: #4a90d9;
        }

        .feature-icon {
            margin-right: 12px;
            font-size: 1rem;
            width: 22px;
            text-align: center;
        }

        .select-btn {
            display: block;
            width: 100%;
            padding: 18px;
            text-align: center;
            border-radius: 10px;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .select-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .select-btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .hacker-btn {
            background: rgba(0, 255, 65, 0.15);
            color: #00ff41;
            border: 2px solid #00ff41;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .hacker-btn:hover {
            background: rgba(0, 255, 65, 0.25);
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.5), inset 0 0 20px rgba(0, 255, 65, 0.1);
        }

        .law-enforcement-btn {
            background: rgba(74, 144, 217, 0.15);
            color: #4a90d9;
            border: 2px solid #4a90d9;
            box-shadow: 0 0 20px rgba(74, 144, 217, 0.2);
        }

        .law-enforcement-btn:hover {
            background: rgba(74, 144, 217, 0.25);
            box-shadow: 0 0 30px rgba(74, 144, 217, 0.5), inset 0 0 20px rgba(74, 144, 217, 0.1);
        }

        /* ===== 對戰設置頁面 ===== */
        #season2-setup-page .main-header {
            margin-bottom: 30px;
        }

        .setup-container {
            background: rgba(25, 25, 40, 0.95);
            border-radius: 15px;
            padding: 40px;
            width: 100%;
            max-width: 900px;
            margin: 0 auto 40px;
            border: 2px solid rgba(74, 144, 217, 0.3);
            box-shadow: 0 0 30px rgba(74, 144, 217, 0.2);
        }

        .setup-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
            color: #4a90d9;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .setup-section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setup-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #4a90d9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 1.05rem;
        }

        .setting-input {
            width: 100%;
            padding: 14px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(74, 144, 217, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .setting-input:focus {
            outline: none;
            border-color: #4a90d9;
            box-shadow: 0 0 10px rgba(74, 144, 217, 0.3);
        }

        .setting-input::placeholder {
            color: #666;
        }

        .setting-note {
            color: #888;
            font-size: 0.9rem;
            margin-top: 8px;
            line-height: 1.5;
        }

        .difficulty-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .difficulty-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(74, 144, 217, 0.2);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .difficulty-card:hover {
            background: rgba(74, 144, 217, 0.1);
            border-color: rgba(74, 144, 217, 0.5);
        }

        .difficulty-card.selected {
            background: rgba(74, 144, 217, 0.2);
            border-color: #4a90d9;
            box-shadow: 0 0 15px rgba(74, 144, 217, 0.4);
        }

        .difficulty-level {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a90d9;
        }

        .difficulty-desc {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .difficulty-time {
            color: #ff9900;
            font-weight: bold;
        }

        /* ===== 遊戲頁面通用樣式 ===== */
        .game-container {
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: 80px 20px 20px;
            min-height: 100vh;
        }

        /* 黑客模式主題 */
        .hacker-ui {
            --primary-color: #00ff41;
            --secondary-color: #0088ff;
            --danger-color: #ff3333;
            --bg-color: rgba(10, 30, 20, 0.95);
            --panel-bg: rgba(5, 15, 10, 0.9);
            --text-color: #e0ffe0;
        }

        /* 執法部門主題 */
        .law-enforcement-ui {
            --primary-color: #4a90d9;
            --secondary-color: #6ab0ff;
            --danger-color: #ff3333;
            --bg-color: rgba(20, 20, 40, 0.95);
            --panel-bg: rgba(15, 15, 30, 0.9);
            --text-color: #e0e0ff;
        }

        /* 遊戲頭部 */
        .game-header {
            background: var(--bg-color);
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 30px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .game-title-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .game-mode-icon {
            font-size: 3rem;
            color: var(--primary-color);
        }

        .game-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--primary-color);
            letter-spacing: 2px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid var(--secondary-color);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff41;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: #ff3333;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .target-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid var(--secondary-color);
        }

        .target-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .target-ip {
            font-family: 'Monaco', monospace;
            color: var(--primary-color);
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .game-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
            width: 100%;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px 25px;
            border: 1px solid var(--primary-color);
            min-width: 180px;
            flex: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* 執法部門專用統計卡片 */
        .evidence-stat {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px 25px;
            border: 1px solid #4a90d9;
            min-width: 180px;
            flex: 1;
        }

        .evidence-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .evidence-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4a90d9;
        }

        /* 主遊戲區域 */
        .game-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1400px) {
            .game-main {
                grid-template-columns: 1fr;
            }
        }

        /* 左側主面板 */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 終端機 */
        .terminal-container {
            background: rgba(5, 5, 5, 0.95);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 500px;
        }

        .terminal-header {
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.8), 
                rgba(20, 20, 30, 0.8));
            padding: 20px;
            border-bottom: 1px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .terminal-status {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .terminal-body {
            padding: 25px;
            flex: 1;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            max-height: 500px;
        }

        .terminal-body::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .terminal-body::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .terminal-output {
            flex: 1;
            margin-bottom: 20px;
        }

        .terminal-line {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.05);
            animation: fadeIn 0.3s ease;
            word-break: break-word;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .terminal-line.command {
            color: var(--primary-color);
            font-weight: bold;
            border-left: 3px solid var(--primary-color);
        }

        .terminal-line.response {
            color: var(--secondary-color);
        }

        .terminal-line.success {
            color: #00ff88;
            border-left: 3px solid #00ff88;
        }

        .terminal-line.error {
            color: #ff5555;
            border-left: 3px solid #ff5555;
        }

        .terminal-line.warning {
            color: #ffaa00;
            border-left: 3px solid #ffaa00;
        }

        .terminal-line.system {
            color: #aaa;
            font-style: italic;
        }

        .terminal-line.alert {
            color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
            border-left: 3px solid #ff3333;
            animation: alertPulse 1s infinite;
        }

        @keyframes alertPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .terminal-input-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .terminal-prompt {
            color: var(--primary-color);
            font-weight: bold;
            margin-right: 15px;
            min-width: 150px;
            font-family: 'Monaco', monospace;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.1rem;
            flex: 1;
            outline: none;
            caret-color: var(--primary-color);
            font-family: 'Monaco', monospace;
        }

        .input-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .suggestion-btn {
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #ccc;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* 工具面板 */
        .tools-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--primary-color);
            min-height: 300px;
        }

        .tools-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tools-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-btn.active {
            background: var(--primary-color);
            color: black;
            border-color: var(--primary-color);
        }

        .category-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .tool-card {
            background: linear-gradient(135deg, rgba(0, 150, 255, 0.3), rgba(0, 100, 200, 0.3));
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #0099ff;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 150, 255, 0.5);
            background: linear-gradient(135deg, rgba(0, 180, 255, 0.5), rgba(0, 130, 230, 0.5));
            border-color: #00ccff;
        }

        .tool-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tool-card.disabled:hover {
            transform: none;
            box-shadow: none;
            background: rgba(30, 30, 40, 0.8);
        }

        .law-enforcement-ui .tool-card {
            background: linear-gradient(135deg, rgba(74, 144, 217, 0.3), rgba(53, 122, 189, 0.3));
            border-color: #4a90d9;
        }

        .law-enforcement-ui .tool-card:hover {
            border-color: #6ab0ff;
            box-shadow: 0 0 20px rgba(74, 144, 217, 0.7);
            background: linear-gradient(135deg, rgba(100, 170, 255, 0.5), rgba(74, 144, 217, 0.5));
        }

        .tool-icon {
            font-size: 2.5rem;
            color: #00ff99;
            margin-bottom: 15px;
        }

        .law-enforcement-ui .tool-icon {
            color: #6ab0ff;
        }

        .tool-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: #ffffff;
            font-size: 1.1rem;
            text-shadow: 0 0 5px rgba(0, 255, 153, 0.5);
        }

        .law-enforcement-ui .tool-name {
            color: #ffffff;
            text-shadow: 0 0 5px rgba(74, 144, 217, 0.5);
        }

        .tool-desc {
            color: #cccccc;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .tool-cooldown {
            font-size: 0.8rem;
            color: #ffaa00;
            margin-top: 10px;
        }

        /* 右側面板 */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 對戰信息面板 */
        .battle-info {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--primary-color);
        }

        .battle-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .opponent-info {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .opponent-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 10px;
        }

        .opponent-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .detail-value {
            font-family: 'Monaco', monospace;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* 證據面板（執法部門專用） */
        .evidence-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--primary-color);
        }

        .evidence-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .evidence-chain {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
            max-height: 250px;
            overflow-y: auto;
        }

        .evidence-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 4px solid #4a90d9;
            transition: all 0.3s;
        }

        .evidence-item.contaminated {
            border-left-color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
        }

        .evidence-item.critical {
            border-left-color: #ff9900;
            background: rgba(255, 153, 0, 0.1);
        }

        .evidence-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }

        .evidence-desc {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .evidence-status {
            font-size: 0.8rem;
            color: #4a90d9;
        }

        .evidence-status.contaminated {
            color: #ff3333;
        }

        /* 身份鎖定面板（執法部門專用） */
        .identity-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--primary-color);
        }

        .identity-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .identity-tiers {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .identity-tier {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--secondary-color);
        }

        .tier-name {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 10px;
        }

        .tier-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .tier-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a90d9, #6ab0ff);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .tier-percentage {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4a90d9;
        }

        .tier-requirement {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        /* 逮捕令面板 */
        .warrant-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .warrant-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .warrant-label {
            font-size: 1rem;
            color: #aaa;
        }

        .warrant-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff9900;
        }

        .warrant-progress {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .warrant-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9900, #ffcc00);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .warrant-actions {
            display: flex;
            gap: 10px;
        }

        /* 控制按鈕 */
        .game-controls {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .control-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn { transition: all 0.3s; position: relative; overflow: hidden; 
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid;
            font-size: 1rem;
            letter-spacing: 1px;
            background: rgba(0, 0, 0, 0.3);
        }

        .btn:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 15px currentColor;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-danger {
            background: rgba(255, 51, 51, 0.2);
            color: #ff3333;
            border-color: #ff3333;
        }

        .btn-success {
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
            border-color: #00ff41;
        }

        .btn-warning {
            background: rgba(255, 153, 0, 0.2);
            color: #ff9900;
            border-color: #ff9900;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: #666;
        }

        /* 通知系統 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(20, 20, 30, 0.95);
            border-left: 4px solid;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 350px;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.hacker {
            border-left-color: #00ff41;
        }

        .notification.law-enforcement {
            border-left-color: #4a90d9;
        }

        .notification.warning {
            border-left-color: #ffaa00;
        }

        .notification.danger {
            border-left-color: #ff3333;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-message {
            color: #ccc;
            line-height: 1.5;
        }

        /* ===== 響應式設計 ===== */
        @media (max-width: 1200px) {
            .game-main {
                grid-template-columns: 1fr;
            }
            
            .identity-tiers {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-logo {
                font-size: 2.5rem;
            }
            
            .mode-selection {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin: 0 auto 30px;
            }

            .mode-card {
                padding: 25px 20px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .game-stats {
                justify-content: center;
            }
            
            .stat-card, .evidence-stat {
                min-width: 140px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                justify-content: center;
            }
            
            .difficulty-options {
                grid-template-columns: 1fr;
            }
            
            nav {
                padding: 0 15px;
            }
            
            .nav-menu {
                gap: 15px;
            }
            
            .nav-menu li a {
                padding: 6px 10px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .main-logo {
                font-size: 2rem;
            }
            
            .mode-title {
                font-size: 1.5rem;
            }
            
            .game-title {
                font-size: 1.8rem;
            }
            
            .stat-card, .evidence-stat {
                min-width: 100%;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .setup-container {
                padding: 20px;
            }
            
            .mode-selection {
                grid-template-columns: 1fr;
                padding: 0 10px;
            }
            
            .terminal-container {
                min-height: 300px;
            }
            
            .game-main {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .game-header {
                flex-direction: column;
                padding: 15px 20px;
            }
            
            nav {
                padding: 0 10px;
                height: 50px;
            }
            
            .nav-menu {
                gap: 8px;
            }
            
            .nav-menu li a {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
            
            .modal-box {
                max-width: 95%;
                padding: 15px;
            }
        }

        /* ===== 自定義模態框 ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 2px solid #4a90d9;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(74, 144, 217, 0.3);
            position: relative;
        }

        .modal-title {
            color: #4a90d9;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-message {
            color: #ccc;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-input {
            width: 100%;
            padding: 14px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(74, 144, 217, 0.5);
            border-radius: 8px;
            color: #4a90d9;
            font-family: inherit;
            font-size: 16px;
            margin-bottom: 25px;
        }

        .modal-input:focus {
            outline: none;
            border-color: #4a90d9;
            box-shadow: 0 0 10px rgba(74, 144, 217, 0.3);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }

        .modal-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #4a90d9 0%, #357abd 100%);
            color: #fff;
        }

        .modal-btn-confirm:hover {
            box-shadow: 0 0 15px rgba(74, 144, 217, 0.5);
        }

        .modal-btn-danger {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
            color: #fff;
        }

        .modal-btn-danger:hover {
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.5);
        }

        /* ===== 結果頁面 ===== */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .result-overlay.active {
            display: flex;
        }

        .result-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 15px;
            padding: 40px;
            max-width: 600px;
            width: 95%;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.7);
            border: 3px solid;
            animation: resultPulse 2s infinite;
        }

        @keyframes resultPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(74, 144, 217, 0.5); }
            50% { box-shadow: 0 0 50px rgba(74, 144, 217, 0.8); }
        }

        .result-box.victory {
            border-color: #00ff41;
        }

        .result-box.defeat {
            border-color: #ff3333;
        }

        .result-box.arrest {
            border-color: #4a90d9;
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px currentColor);
        }

        .result-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .result-box.victory .result-title {
            color: #00ff41;
            text-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }

        .result-box.defeat .result-title {
            color: #ff3333;
            text-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
        }

        .result-box.arrest .result-title {
            color: #4a90d9;
            text-shadow: 0 0 20px rgba(74, 144, 217, 0.5);
        }

        .result-message {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .result-stats {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
        }

        .result-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-stat:last-child {
            border-bottom: none;
        }

        .result-stat-label {
            color: #aaa;
        }

        .result-stat-value {
            color: #fff;
            font-weight: bold;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .result-btn {
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            border: 2px solid;
        }

        .result-btn-primary {
            background: linear-gradient(135deg, #4a90d9 0%, #357abd 100%);
            color: #fff;
            border-color: #4a90d9;
        }

        .result-btn-primary:hover {
            box-shadow: 0 0 20px rgba(74, 144, 217, 0.5);
        }

        .result-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: #666;
        }

        .result-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 新增加的樣式 */
        .department-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .department-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4a90d9;
        }

        .department-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
        }

        .status-inactive {
            background: rgba(255, 51, 51, 0.2);
            color: #ff3333;
        }

        .department-resources {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .resource-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .resource-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .resource-value {
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
        }

        .critical-evidence {
            background: rgba(255, 153, 0, 0.2);
            border-left: 4px solid #ff9900;
            animation: pulseCritical 2s infinite;
        }

        @keyframes pulseCritical {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .evidence-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .evidence-action-btn {
            padding: 5px 10px;
            background: rgba(74, 144, 217, 0.3);
            border: 1px solid #4a90d9;
            border-radius: 4px;
            color: #fff;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .evidence-action-btn:hover {
            background: rgba(74, 144, 217, 0.5);
        }

        .arrest-countdown {
            background: rgba(255, 153, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            animation: pulseArrest 1s infinite;
        }

        @keyframes pulseArrest {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 153, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 153, 0, 0.8); }
        }

        .arrest-timer {
            font-size: 2rem;
            font-weight: bold;
            color: #ff9900;
            margin: 10px 0;
        }

        .server-health {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .health-bar {
            flex: 1;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #00aa00);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .health-text {
            font-size: 0.9rem;
            color: #fff;
            min-width: 40px;
        }

        .investigation-report {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
        }

        .report-line {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .evidence-quality {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .quality-indicator {
            height: 8px;
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff3333, #ff9900, #00ff41);
            border-radius: 4px;
        }

        /* 新功能樣式 */
        .dynamic-intel-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .intel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .intel-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4a90d9;
        }

        .intel-verification {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
        }

        .intel-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .intel-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border-left: 3px solid #4a90d9;
        }

        .intel-item.fake {
            border-left-color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
        }

        .compromised-device {
            background: rgba(255, 153, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff9900;
        }

        .device-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 4px;
        }

        .info-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 3px;
        }

        .info-value {
            font-family: 'Monaco', monospace;
            font-size: 0.9rem;
            color: #fff;
        }

        .decryption-panel {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff9900;
        }

        .decryption-progress {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .decryption-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9900, #ffcc00);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .network-sweep {
            background: rgba(74, 144, 217, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #4a90d9;
            animation: networkSweepPulse 2s infinite;
        }

        @keyframes networkSweepPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(74, 144, 217, 0.5); }
            50% { box-shadow: 0 0 20px rgba(74, 144, 217, 0.8); }
        }

        .fake-command-log {
            background: rgba(255, 51, 51, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff3333;
            max-height: 150px;
            overflow-y: auto;
        }

        .command-entry {
            padding: 5px;
            margin-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Monaco', monospace;
            font-size: 0.85rem;
        }

        .command-entry.fake {
            color: #ff3333;
        }

        .command-entry.real {
            color: #00ff41;
        }

        .advanced-tool-card {
            background: linear-gradient(135deg, rgba(255, 153, 0, 0.3), rgba(255, 102, 0, 0.3));
            border-color: #ff9900;
        }

        .advanced-tool-card:hover {
            border-color: #ffcc00;
            box-shadow: 0 0 20px rgba(255, 153, 0, 0.7);
            background: linear-gradient(135deg, rgba(255, 180, 0, 0.5), rgba(255, 130, 0, 0.5));
        }

        .darknet-market {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #00ff41;
        }

        .market-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background: rgba(0, 255, 65, 0.1);
            border-radius: 4px;
        }

        .gps-tracker {
            background: rgba(0, 150, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #0096ff;
        }

        .tracker-map {
            height: 100px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .tracker-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff3333;
            animation: trackerPulse 1s infinite;
        }

        @keyframes trackerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }

        .signal-jammer {
            background: rgba(255, 0, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff00ff;
            animation: jammerPulse 1.5s infinite;
        }

        @keyframes jammerPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 0, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.8); }
        }

        /* 截圖風格的版面樣式 */
        .target-system-info {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .system-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .system-detail {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
        }

        .system-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .system-value {
            font-family: 'Monaco', monospace;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .attack-path-visualization {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--primary-color);
        }

        .path-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .path-timeline {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .path-event {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
        }

        .path-time {
            color: #aaa;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .path-action {
            color: var(--primary-color);
            font-weight: bold;
        }

        .system-status-bars {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .status-label {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .status-percentage {
            font-size: 0.8rem;
            color: #ff9900;
            margin-top: 5px;
        }

        /* 商店系統增強 */
        .shop-container {
            max-height: 70vh;
            overflow-y: auto;
        }

        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .shop-category {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-category.active {
            background: #4a90d9;
            color: #000;
            border-color: #4a90d9;
        }

        .shop-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .shop-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .shop-item-name {
            color: #fff;
            font-weight: bold;
        }

        .shop-item-price {
            color: #ff9900;
            font-weight: bold;
        }

        .shop-item-desc {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .shop-item-effect {
            color: #00ff41;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        /* 充值系統 */
        .topup-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ff9900;
        }

        .topup-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .topup-option {
            background: rgba(255, 153, 0, 0.2);
            border: 1px solid #ff9900;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .topup-option:hover {
            background: rgba(255, 153, 0, 0.4);
        }

        .topup-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff9900;
        }

        .topup-price {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 5px;
        }

        /* 交易歷史 */
        .transaction-history {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .transaction-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
        }

        .transaction-type {
            font-weight: bold;
        }

        .transaction-type.purchase {
            color: #00ff41;
        }

        .transaction-type.topup {
            color: #ff9900;
        }

        .transaction-amount {
            color: #fff;
        }

        .transaction-time {
            color: #aaa;
            font-size: 0.8rem;
        }

        /* 任務目標面板 */
        .mission-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
        }

        .mission-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mission-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mission-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mission-name {
            color: #ccc;
        }

        .mission-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .mission-complete {
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
        }

        .mission-incomplete {
            background: rgba(255, 153, 0, 0.2);
            color: #ff9900;
        }

        /* 攻擊/防禦視覺化 */
        .attack-defense-visualization {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--primary-color);
        }

        .visualization-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-label {
            width: 120px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .progress-container {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .attack-progress {
            background: linear-gradient(90deg, #ff3333, #ff9900);
        }

        .defense-progress {
            background: linear-gradient(90deg, #4a90d9, #6ab0ff);
        }

        .stealth-progress {
            background: linear-gradient(90deg, #00ff41, #00aa00);
        }

        /* 擴充的系統健康視覺化 */
        .health-visualization {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .health-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .health-card-title {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .health-card-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .health-card.high {
            border: 1px solid #00ff41;
            color: #00ff41;
        }

        .health-card.medium {
            border: 1px solid #ff9900;
            color: #ff9900;
        }

        .health-card.low {
            border: 1px solid #ff3333;
            color: #ff3333;
        }

        /* 實時目標信息顯示增強 */
        .target-realtime-info {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--secondary-color);
        }

        .realtime-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .realtime-name {
            color: var(--primary-color);
            font-weight: bold;
        }

        .realtime-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: rgba(0, 255, 65, 0.2);
            color: #00ff41;
        }

        .realtime-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .realtime-detail {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        .realtime-label {
            font-size: 0.7rem;
            color: #aaa;
            margin-bottom: 3px;
        }

        .realtime-value {
            font-size: 0.9rem;
            color: #fff;
            font-weight: bold;
        }
    
        /* 新增功能樣式 */
        .step-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            background: rgba(10, 10, 25, 0.98);
            border: 2px solid #4a90d9;
            border-radius: 10px;
            z-index: 2000;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 100, 255, 0.5);
            display: none;
        }
        .step-window.active { display: block; }
        .step-header { font-size: 1.2rem; color: #4a90d9; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .step-content { margin-bottom: 20px; }
        .step-item { margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; }
        .step-progress-container { height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .step-progress-fill { height: 100%; width: 0%; background: #4a90d9; transition: width 0.3s; }
        .step-btn { background: #4a90d9; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        .step-btn:disabled { background: #555; cursor: not-allowed; }
        .step-progress-container { height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .step-progress-fill { height: 100%; width: 0%; background: #4a90d9; transition: width 0.3s; }
        
        /* 網絡拓撲圖樣式 */
        .network-topology {
            width: 100%;
            height: 250px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #333;
            border-radius: 8px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        .node {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #1a1a3a;
            border: 2px solid #4a90d9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 5;
            transition: all 0.3s;
        }
        .node:hover { transform: scale(1.2); box-shadow: 0 0 15px #4a90d9; }
        .node.hacker { border-color: #00ff41; }
        .node.target { border-color: #ff3333; }
        .node-label { position: absolute; bottom: -20px; font-size: 0.7rem; white-space: nowrap; }
        .connection-line {
            position: absolute;
            height: 2px;
            background: rgba(74, 144, 217, 0.3);
            transform-origin: left center;
            z-index: 1;
        }
        .connection-line.active { background: #ff3333; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }

        /* 日誌監控面板樣式 */
        .log-monitor {
            background: #050505;
            border: 1px solid #333;
            border-radius: 8px;
            height: 200px;
            display: flex;
            flex-direction: column;
            margin-top: 15px;
        }
        .log-tabs { display: flex; background: #111; border-bottom: 1px solid #333; }
        .log-tab { padding: 5px 15px; cursor: pointer; font-size: 0.8rem; color: #888; }
        .log-tab.active { background: #222; color: #4a90d9; border-bottom: 2px solid #4a90d9; }
        .log-display { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.75rem; color: #00ff41; font-family: monospace; }
        .log-filter { padding: 5px; background: #111; border-top: 1px solid #333; display: flex; }
        .log-filter input { background: #000; border: 1px solid #333; color: #fff; font-size: 0.7rem; padding: 2px 5px; flex: 1; }
    
    
        /* 擴展功能樣式 */
        .resource-bar { height: 8px; background: #222; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .resource-fill { height: 100%; background: #ffcc00; transition: width 0.3s; }
        .reputation-badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; background: #4a90d9; color: #fff; margin-left: 10px; }
        .identity-card { background: rgba(255,255,255,0.05); border: 1px solid #333; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .court-evidence-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 0.85rem; }
        .contamination-warning { color: #ff3333; font-size: 0.7rem; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    
    </style>
</head>
<body>
    <!-- 導航欄 -->
    <nav id="navbar">
        <div class="nav-logo" onclick="goToMainPage()">
            <i class="fas fa-gavel"></i> 執法對決 SEASON 2
        </div>
        <ul class="nav-menu">
            <li><a onclick="goToMainPage()" id="nav-home">主頁</a></li>
            <li><a onclick="showSetupPage()" id="nav-season2">開始第二季對戰</a></li>
            <li><a onclick="showGuide()" id="nav-guide">操作指南</a></li>
            <li><a onclick="openShop()" id="nav-shop">商店</a></li>
            <li><a onclick="openTransactionHistory()" id="nav-history">交易記錄</a></li>
        </ul>
    </nav>

    <!-- 屏幕效果 -->
    <div class="screen-effects">
        <div class="scanlines"></div>
    </div>

    <!-- 通知系統 -->
    
    <!-- 分步操作彈窗 -->
    <div id="step-modal" class="step-window">
        <div class="step-header">
            <span id="step-modal-title">工具操作</span>
            <i class="fas fa-times" onclick="closeStepModal()" style="cursor:pointer"></i>
        </div>
        <div id="step-modal-content" class="step-content">
            <!-- 動態生成內容 -->
        </div>
        <div class="modal-buttons" id="step-modal-buttons">
            <!-- 動態生成按鈕 -->
        </div>
    </div>

    <!-- 勝負結算動畫 -->
    <div id="game-result-animation" class="result-overlay" style="display:none; z-index: 3000;">
        <div class="result-box" id="victory-box">
            <div id="victory-animation-content"></div>
            <div id="victory-report-content" style="text-align:left; margin-top:20px; max-height:400px; overflow-y:auto; background:rgba(0,0,0,0.5); padding:15px; border-radius:5px; font-size:0.9rem;"></div>
            <div class="result-actions">
                <button class="result-btn result-btn-primary" onclick="location.reload()">返回主頁</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title">
            <i class="fas fa-info-circle"></i>
            <span id="notification-title-text">系統通知</span>
        </div>
        <div class="notification-message" id="notification-message"></div>
    </div>

    <!-- 主頁面 -->
    <div id="main-page" class="page active">
        <div class="main-header">
            <div class="season-badge">SEASON 2 • 執法對決</div>
            <div class="main-logo">黑客 vs 執法部門 網絡大戰場 第二季</div>
            <div class="main-subtitle">Hacker VS 執法部門 網絡大戰場 第二季SEASON 2  • 高強度身份攻防戰</div>
            <div class="main-tagline">
                延續第一季的激烈對戰，第二季帶來全新的「黑客 vs 執法部門」對決！
                黑客需要隱藏身份逃脫追捕，執法部門則需調查證據鎖定身份。雙方都有強大的專屬工具和策略系統。
                這是一場真正的智力與技術的較量！
            </div>
        </div>

        <!-- 模式選擇 -->
        <div class="mode-selection">
            <!-- 黑客模式卡片 -->
            <div class="mode-card hacker">
                <div class="mode-icon">
                    <i class="fas fa-user-secret"></i>
                </div>
                <div class="mode-title">扮演黑客</div>
                <div class="mode-description">
                    作為頂尖黑客，你需要隱藏身份、清除數碼足跡、反制調查，並在必要時發動反擊。
                    使用全新專屬工具保護自己，逃脫執法部門的追捕。
                </div>
                <ul class="mode-features">
                    <li>
                        <span class="feature-icon"><i class="fas fa-eraser"></i></span>
                        <span>清除數碼足跡與流量偽裝</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-virus-slash"></i></span>
                        <span>證據污染與數據注入攻擊</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-mask"></i></span>
                        <span>身份隱藏與動態跳板網絡</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-bug"></i></span>
                        <span>干擾執法部門分析工具</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-skull-crossbones"></i></span>
                        <span>反擊執法部門系統</span>
                    </li>
                </ul>
                <button class="select-btn hacker-btn" onclick="selectRole('hacker')">
                    <i class="fas fa-skull-crossbones"></i>
                    <span>選擇黑客角色</span>
                </button>
            </div>

            <!-- 執法部門模式卡片 -->
            <div class="mode-card law-enforcement">
                <div class="mode-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="mode-title">執法部門</div>
                <div class="mode-description">
                    作為網絡安全執法部門，你需要調查黑客身份、收集證據鏈、鎖定目標，
                    並申請逮捕令進行最終拘捕。使用先進的調查工具和分析系統。
                </div>
                <ul class="mode-features">
                    <li>
                        <span class="feature-icon"><i class="fas fa-search"></i></span>
                        <span>高強度調查與證據分析</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-fingerprint"></i></span>
                        <span>三階層身份鎖定機制</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-users-cog"></i></span>
                        <span>跨部門協作與資源管理</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-file-contract"></i></span>
                        <span>逮捕令申請與執行系統</span>
                    </li>
                    <li>
                        <span class="feature-icon"><i class="fas fa-server"></i></span>
                        <span>指揮中心與證據庫防禦</span>
                    </li>
                </ul>
                <button class="select-btn law-enforcement-btn" onclick="selectRole('law_enforcement')">
                    <i class="fas fa-shield-alt"></i>
                    <span>選擇執法部門角色</span>
                </button>
            </div>
        </div>

        <!-- 版權聲明 -->
        <div class="copyright" style="text-align: center; padding: 40px 20px 20px; color: #666; font-size: 0.9rem; max-width: 800px; margin: 0 auto;">
            <div style="background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.2); border-radius: 8px; padding: 15px; margin: 20px 0; text-align: center; color: #ff5555; font-size: 0.9rem; line-height: 1.5;">
                <strong>⚠️ 重要聲明：</strong><br>
                這是純粹的網絡安全教育模擬平台，所有操作均為模擬效果，不會影響真實系統。
                平台不會收集任何個人或私隱資料，也不建議進行真實的非法黑客行為。
                模擬器旨在幫助了解網絡攻防流程與執法調查過程。
            </div>
            
            <p>
                <strong>© 2025 對戰模式第二季 • 執法對決 SEASON 2</strong><br>
                版權所有 © 2025 Sam. T. 保留所有權利。<br>
                此平台為第一季對戰模式的續集版本，專為網絡安全教育而設計。
            </p>
        </div>
    </div>

    <!-- 對戰設置頁面 -->
    <div id="season2-setup-page" class="page">
        <div class="main-header">
            <div class="season-badge">SEASON 2 • 設置對戰</div>
            <div class="main-logo" id="setup-title">對戰設置</div>
            <div class="main-subtitle" id="setup-subtitle">配置你的第二季對戰參數</div>
        </div>

        <div class="setup-container">
            <div class="setup-title">
                <i class="fas fa-cogs"></i>
                <span>第二季對戰設置</span>
            </div>

            <!-- 角色選擇確認 -->
            <div class="setup-section">
                <div class="section-title">
                    <i class="fas fa-user-tag"></i>
                    <span>已選擇角色</span>
                </div>
                <div class="setting-group">
                    <div id="selected-role-display" style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #4a90d9;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #4a90d9;">
                            <i class="fas fa-question-circle"></i>
                            <span id="selected-role-name">尚未選擇角色</span>
                        </div>
                        <div style="color: #aaa; font-size: 0.95rem;" id="selected-role-desc">
                            請返回主頁選擇角色
                        </div>
                    </div>
                </div>
            </div>

            <!-- 對戰設置 -->
            <div class="setup-section">
                <div class="section-title">
                    <i class="fas fa-network-wired"></i>
                    <span>網絡設置</span>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">你的虛擬IP地址：</label>
                    <input type="text" id="player-ip" class="setting-input" value="192.168.1.100" readonly>
                    <div class="setting-note">
                        這是你的唯一識別ID，在對戰中將用於識別你的設備。
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label">對手IP地址：</label>
                    <input type="text" id="opponent-ip" class="setting-input" placeholder="輸入對手IP地址 (例: 192.168.1.200)">
                    <div class="setting-note">
                        輸入對手的虛擬IP地址開始對戰。你可以選擇與AI對戰或與朋友對戰。
                    </div>
                </div>
            </div>

            <!-- AI難度設置 -->
            <div class="setup-section">
                <div class="section-title">
                    <i class="fas fa-robot"></i>
                    <span>AI對手難度</span>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">選擇AI難度級別：</label>
                    <div class="difficulty-options">
                        <div class="difficulty-card" data-level="rookie" onclick="selectDifficulty('rookie', this)">
                            <div class="difficulty-level" style="color: #00ff41;">新手級</div>
                            <div class="difficulty-desc">AI反應較慢，適合學習玩法</div>
                            <div class="difficulty-time">對戰時間: 30分鐘</div>
                        </div>
                        
                        <div class="difficulty-card selected" data-level="professional" onclick="selectDifficulty('professional', this)">
                            <div class="difficulty-level" style="color: #4a90d9;">專業級</div>
                            <div class="difficulty-desc">標準AI對手，平衡的挑戰性</div>
                            <div class="difficulty-time">對戰時間: 25分鐘</div>
                        </div>
                        
                        <div class="difficulty-card" data-level="elite" onclick="selectDifficulty('elite', this)">
                            <div class="difficulty-level" style="color: #ff9900;">精英級</div>
                            <div class="difficulty-desc">AI反應迅速，具有侵略性</div>
                            <div class="difficulty-time">對戰時間: 20分鐘</div>
                        </div>
                        
                        <div class="difficulty-card" data-level="legendary" onclick="selectDifficulty('legendary', this)">
                            <div class="difficulty-level" style="color: #ff3333;">傳奇級</div>
                            <div class="difficulty-desc">最高難度，AI使用高級策略</div>
                            <div class="difficulty-time">對戰時間: 15分鐘</div>
                        </div>
                    </div>
                    <div class="setting-note">
                        難度越高，AI對手的反應速度越快，使用的策略也越複雜。
                    </div>
                </div>
            </div>

            <!-- 開始對戰按鈕 -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="startSeason2Battle()" style="padding: 18px 50px; font-size: 1.2rem;">
                    <i class="fas fa-play-circle"></i>
                    <span>開始第二季對戰</span>
                </button>
                <div style="margin-top: 20px;">
                    <button class="btn back-btn" onclick="goToMainPage()">
                        <i class="fas fa-arrow-left"></i>
                        <span>返回主頁</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 遊戲頁面 -->
    <div id="game-page" class="page"></div>

    <!-- 自定義模態框 -->
    <div class="modal-overlay" id="custom-modal">
        <div class="modal-box">
            <div class="modal-title">
                <i class="fas fa-terminal"></i>
                <span id="modal-title-text">系統提示</span>
            </div>
            <div class="modal-message" id="modal-message"></div>
            <input type="text" class="modal-input" id="modal-input" style="display: none;">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="modal-cancel">取消</button>
                <button class="modal-btn modal-btn-confirm" id="modal-confirm">確定</button>
            </div>
        </div>
    </div>

    <!-- 結果頁面 -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-box" id="result-box">
            <div class="result-icon" id="result-icon"></div>
            <div class="result-title" id="result-title"></div>
            <div class="result-message" id="result-message"></div>
            <div class="result-stats" id="result-stats"></div>
            <div class="result-actions">
                <button class="result-btn result-btn-primary" onclick="goToMainPage()">
                    <i class="fas fa-home"></i> 返回主頁
                </button>
                <button class="result-btn result-btn-secondary" onclick="showSetupPage()">
                    <i class="fas fa-redo"></i> 重新對戰
                </button>
            </div>
        </div>
    </div>

    <!-- 商店頁面 -->
    <div class="modal-overlay" id="shop-modal">
        <div class="modal-box" style="max-width: 800px;">
            <div class="modal-title">
                <i class="fas fa-shopping-cart"></i>
                <span id="shop-title">商店</span>
            </div>
            <div class="modal-message" id="shop-message"></div>
        </div>
    </div>

    <!-- 交易歷史頁面 -->
    <div class="modal-overlay" id="history-modal">
        <div class="modal-box" style="max-width: 800px;">
            <div class="modal-title">
                <i class="fas fa-history"></i>
                <span>交易歷史記錄</span>
            </div>
            <div class="modal-message" id="history-message"></div>
        </div>
    </div>

    <script>
        // ===== 全局變量 =====
        let GameState = {
            currentRole: null,
            currentPage: 'main',
            gameActive: false,
            connectionStatus: 'disconnected',
            playerIP: '192.168.1.100',
            opponentIP: '',
            difficulty: 'professional',
            gameMode: 'season2',
            currentStepTask: null,
            logs: { system: [], security: [], communication: [] },
            missionSteps: {},
            topologyNodes: [],
            reputation: { hacker: 0, le: 0 },
            resources: { hacker: 1000, le: 1000 },
            identities: [], // 黑客虛擬身份
            courtPhase: false,
            internationalSupport: false,
            
            // 交易記錄
            transactionHistory: [],
            
            // ===== 新系統屬性 =====
            // 技能樹系統
            skillTrees: {
                hacker: {
                    stealth: { level: 1, maxLevel: 5, cost: 5000, effect: '+10% 隱蔽度' },
                    encryption: { level: 1, maxLevel: 5, cost: 6000, effect: '+15% 加密強度' },
                    evasion: { level: 1, maxLevel: 5, cost: 7000, effect: '+20% 躲避偵測' },
                    counter_forensics: { level: 1, maxLevel: 5, cost: 8000, effect: '+25% 反取證能力' },
                    attack_power: { level: 1, maxLevel: 5, cost: 10000, effect: '+15% 攻擊力' }
                },
                law_enforcement: {
                    investigation: { level: 1, maxLevel: 5, cost: 5000, effect: '+10% 調查速度' },
                    tracking: { level: 1, maxLevel: 5, cost: 6000, effect: '+15% 追蹤精度' },
                    forensics: { level: 1, maxLevel: 5, cost: 7000, effect: '+20% 鑑識能力' },
                    collaboration: { level: 1, maxLevel: 5, cost: 8000, effect: '+25% 協作效率' },
                    defense: { level: 1, maxLevel: 5, cost: 10000, effect: '+15% 防禦力' }
                }
            },
            
            // 裝備系統
            equipmentSlots: {
                hacker: {
                    armor: null, // 隱蔽斗篷、防火牆等
                    weapon: null, // 攻擊工具
                    accessory: null // 輔助工具
                },
                law_enforcement: {
                    armor: null, // 防禦套件
                    weapon: null, // 攻擊工具
                    accessory: null // 輔助工具
                }
            },
            
            equipmentPool: [
                { id: 'stealth_cloak', type: 'armor', role: 'hacker', name: '隱蔽斗篷', bonus: '+15% 隱蔽度', cost: 30000 },
                { id: 'zero_day_kit', type: 'weapon', role: 'hacker', name: '零日工具包', bonus: '+25% 攻擊力', cost: 50000 },
                { id: 'proxy_chain', type: 'accessory', role: 'hacker', name: '代理鏈', bonus: '+10% 躲避', cost: 20000 },
                { id: 'defense_wall', type: 'armor', role: 'law_enforcement', name: '防禦牆', bonus: '+20% 防禦', cost: 40000 },
                { id: 'counter_strike', type: 'weapon', role: 'law_enforcement', name: '反擊工具', bonus: '+30% 攻擊力', cost: 55000 },
                { id: 'tracking_beacon', type: 'accessory', role: 'law_enforcement', name: '追蹤信標', bonus: '+15% 追蹤精度', cost: 25000 }
            ],
            
            // 聲望/等級系統
            playerLevel: {
                hacker: { level: 1, experience: 0, nextLevelExp: 1000, reputation: 0, title: '初級駭客' },
                law_enforcement: { level: 1, experience: 0, nextLevelExp: 1000, reputation: 0, title: '初級調查員' }
            },
            
            // 證據完整性系統
            evidenceIntegrity: {
                md5Hash: {},
                sha256Hash: {},
                timestamp: {},
                digitalSignature: {},
                chainOfCustody: []
            },
            
            // 搜查令申請系統
            searchWarrants: {
                requested: false,
                requirementsMet: false,
                requiredEvidence: 3,
                requiredLockLevel: 80,
                approvalStatus: 'pending', // pending, approved, denied
                timeline: []
            },
            
            // 聯合任務中心
            jointOperationCenter: {
                operationId: null,
                participatingDepts: [],
                sharedResources: {},
                operationPhase: 'planning', // planning, execution, completion
                timeline: []
            },
            
            // 自動存檔
            autoSaveInterval: null,
            lastSaveTime: null,
            
            // 玩家數據
            playerData: {
                hacker: {
                    money: 150000,
                    stealth: 60,
                    encryptionLevel: 40,
                    tools: [],
                    cooldowns: {},
                    attackPower: 15,
                    defensePower: 10,
                    controlProgress: 0,
                    digitalFootprints: 5,
                    compromisedEvidence: 0,
                    serverHealth: 100,
                    deviceHealth: 100,
                    criticalSystems: ['command_center', 'evidence_library', 'network_infrastructure'],
                    stolenDocuments: [],
                    decryptionProgress: 0,
                    compromisedDevices: [],
                    darknetCredits: 0,
                    activeVpnNodes: 3,
                    signalJamming: false,
                    realtimeIntel: [],
                    shopItems: [
                        { id: 'vpn_chain', name: '高級VPN鏈', price: 20000, effect: '+20%隱蔽度', category: 'stealth' },
                        { id: 'zero_day', name: '零日漏洞利用', price: 50000, effect: '+40攻擊力', category: 'attack' },
                        { id: 'crypto_mixer', name: '加密貨幣混合器', price: 30000, effect: '資金追蹤干擾', category: 'stealth' },
                        { id: 'ai_evasion', name: 'AI逃避工具', price: 40000, effect: '降低被偵測機率', category: 'stealth' },
                        { id: 'memory_attack', name: '記憶體無檔案攻擊套件', price: 60000, effect: '無痕跡攻擊', category: 'attack' },
                        { id: 'dynamic_proxy', name: '動態跳板網絡', price: 45000, effect: '隨機路由隱藏', category: 'stealth' },
                        { id: 'bait_server', name: '誘餌伺服器', price: 35000, effect: '誤導追蹤', category: 'counter' },
                        { id: 'fake_fingerprint', name: '偽造攻擊指紋工具', price: 55000, effect: '偽裝攻擊來源', category: 'counter' },
                        { id: 'signal_jammer', name: '協作頻道干擾器', price: 40000, effect: '阻斷通訊', category: 'counter' },
                        { id: 'darknet_access', name: '暗網委託市場介面', price: 70000, effect: '購買黑市工具', category: 'advanced' },
                        { id: 'phishing_kit', name: '社會工程釣魚生成器', price: 30000, effect: '欺騙目標', category: 'infiltration' },
                        { id: 'vulnerability_storage', name: '零漏洞儲存與部署模組', price: 80000, effect: '儲存攻擊工具', category: 'attack' },
                        { id: 'encryption_relay', name: '加密通道中繼器', price: 35000, effect: '加強加密通訊', category: 'stealth' },
                        { id: 'hardware_spoof', name: '硬體指紋偽造器', price: 50000, effect: '偽造設備識別', category: 'stealth' },
                        { id: 'node_crippler', name: '網路節點癱瘓工具', price: 65000, effect: '癱瘓網絡節點', category: 'attack' },
                        { id: 'ransomware', name: '高級勒索軟件', price: 75000, effect: '加密目標文件勒索', category: 'attack' },
                        { id: 'traffic_encryptor', name: '流量加密器', price: 45000, effect: '完全加密所有流量', category: 'stealth' },
                        { id: 'location_blur', name: '物理位置模糊器', icon: 'fa-braille', desc: '模糊真實物理定位', cooldown: 40, effect: 'blur', cost: 25000 },
                        { id: 'signal_spoof', name: '信號源偽造器', icon: 'fa-broadcast-tower', desc: '偽造無線信號來源', cooldown: 35, effect: 'spoof', cost: 18000 },
                        { id: 'identity_hider', name: '身份隱藏器', price: 55000, effect: '完全隱藏真實身份', category: 'stealth' },
                        { id: 'file_wiper', name: '文件擦除器', price: 40000, effect: '完全刪除痕跡', category: 'counter' },
                        { id: 'backdoor_implant', name: '持久後門植入', price: 60000, effect: '永久系統訪問', category: 'infiltration' }
                    ]
                },
                law_enforcement: {
                    budget: 200000,
                    investigationProgress: 0,
                    evidenceChain: [],
                    criticalEvidence: [],
                    identityLock: {
                        technical: 0,
                        social: 0,
                        physical: 0
                    },
                    warrantProgress: 0,
                    warrantIssued: false,
                    arrestCountdown: null,
                    departments: {
                        cyber: { name: '網絡安全調查部門', active: true, resources: 100 },
                        criminal: { name: '刑事偵緝科', active: false, resources: 0 },
                        antiTerror: { name: '互聯網反恐科', active: false, resources: 0 },
                        forensic: { name: '數碼鑑證科', active: true, resources: 100 }
                    },
                    serverHealth: 100,
                    evidenceLibraryHealth: 100,
                    analysisToolsHealth: 100,
                    tools: [],
                    cooldowns: {},
                    dynamicIntel: [],
                    verifiedIntel: [],
                    networkSweepActive: false,
                    activeHoneypots: 0,
                    compromisedDevices: [],
                    gpsTracking: false,
                    signalBlocking: false,
                    realtimeTracking: [],
                    shopItems: [
                        { id: 'ai_analyst', name: 'AI分析師', price: 30000, effect: '+15%調查速度', category: 'investigation' },
                        { id: 'forensic_suite', name: '高級鑑識套件', price: 50000, effect: '證據質量提升', category: 'investigation' },
                        { id: 'interpol_access', name: '國際刑警資料庫訪問', price: 40000, effect: '全球追蹤能力', category: 'tracking' },
                        { id: 'cyber_swat', name: '網絡特警隊', price: 60000, effect: '即時反應部隊', category: 'defense' },
                        { id: 'digital_sandbox', name: '數碼鑑識沙盒', price: 55000, effect: '深度惡意軟件分析', category: 'investigation' },
                        { id: 'network_mapper', name: '網路流量繪圖儀', price: 45000, effect: '可視化流量分析', category: 'tracking' },
                        { id: 'social_analyzer', name: '社交圖譜分析器', price: 40000, effect: '社交網絡關聯分析', category: 'investigation' },
                        { id: 'threat_sensor', name: '全網威脅感測器', price: 60000, effect: '實時威脅檢測', category: 'defense' },
                        { id: 'emergency_shutdown', name: '緊急斷流', price: 35000, effect: '切斷網絡連接', category: 'defense' },
                        { id: 'intercept_key', name: '合法攔截密鑰', price: 70000, effect: '解密密碼通訊', category: 'decryption' },
                        { id: 'command_panel', name: '跨部門指揮面板', price: 50000, effect: '協調多部門行動', category: 'collaboration' },
                        { id: 'signal_blocker', name: '阻擋防止幹擾信號', price: 45000, effect: '防止通訊干擾', category: 'defense' },
                        { id: 'gps_tracker', name: '超強GPS衛星定位', price: 65000, effect: '精確位置追蹤', category: 'tracking' },
                        { id: 'cctv_access', name: '收集CCTV系統訪問', price: 40000, effect: '監控錄像分析', category: 'tracking' },
                        { id: 'password_cracker', name: '破解裝置加密密碼', price: 75000, effect: '強制解密密碼', category: 'decryption' },
                        { id: 'memory_forensics', name: '內存取證工具', price: 60000, effect: '分析內存攻擊痕跡', category: 'investigation' },
                        { id: 'blockchain_tracker', name: '區塊鏈追蹤系統', price: 80000, effect: '追蹤加密貨幣流向', category: 'tracking' },
                        { id: 'ai_predictor', name: 'AI行為預測系統', price: 90000, effect: '預測黑客行動', category: 'defense' },
                        { id: 'evidence_protector', name: '證據保護系統', price: 55000, effect: '防止證據污染', category: 'defense' },
                        { id: 'rapid_response', name: '快速反應小組', price: 70000, effect: '立即行動能力', category: 'defense' }
                    ]
                }
            },
            
            // 對手數據 (AI)
            opponentData: {
                hacker: {
                    money: 180000,
                    stealth: 70,
                    encryptionLevel: 50,
                    tools: ['nmap', 'metasploit', 'log_cleaner', 'spoofing', 'ddos'],
                    attackPattern: 'aggressive',
                    defenseLevel: 50,
                    digitalFootprints: 5,
                    compromisedEvidence: 0,
                    stolenDocuments: [],
                    activeVpnNodes: 4,
                    signalJamming: false,
                    serverHealth: 100,
                    deviceHealth: 100
                },
                law_enforcement: {
                    budget: 220000,
                    investigationProgress: 0,
                    evidenceChain: [],
                    identityLock: {
                        technical: 0,
                        social: 0,
                        physical: 0
                    },
                    departments: {
                        cyber: { active: true, resources: 100 },
                        criminal: { active: true, resources: 80 },
                        antiTerror: { active: false, resources: 0 },
                        forensic: { active: true, resources: 90 }
                    },
                    aggressionLevel: 40,
                    dynamicIntel: [],
                    networkSweepActive: false,
                    serverHealth: 100,
                    evidenceLibraryHealth: 100,
                    analysisToolsHealth: 100
                }
            },
            
            // 遊戲時間
            gameStartTime: null,
            gameTimeLimit: 1500, // 25分鐘 (預設更長時間)
            gameTimer: null,
            
            // 專屬工具配置 (增強版)
            tools: {
                hacker: {
                    reconnaissance: [
                        { id: "nmap", name: "Nmap掃描器", icon: "fa-search", desc: "掃描目標網絡拓撲和開放端口", cooldown: 5, effect: "scan", cost: 0 },
                        { id: "whois", name: "Whois深度查詢", icon: "fa-address-card", desc: "查詢目標域名註冊信息及歷史記錄", cooldown: 3, effect: "info", cost: 0 },
                        { id: "dns_enum", name: "DNS深度枚舉", icon: "fa-sitemap", desc: "枚舉目標DNS記錄、子域名和關聯服務", cooldown: 4, effect: "info", cost: 0 },
                        { id: "device_scanner", name: "設備掃描器", icon: "fa-mobile-alt", desc: "掃描目標網絡中的連接設備", cooldown: 6, effect: "scan", cost: 5000 },
                        { id: "port_scanner", name: "端口掃描器", icon: "fa-plug", desc: "深度掃描目標開放端口及服務", cooldown: 7, effect: "scan", cost: 3000 }
                    ],
                    stealth: [
                        { id: "log_cleaner", name: "智能日誌清理工具", icon: "fa-eraser", desc: "清除系統日誌、訪問記錄及審計追蹤", cooldown: 8, effect: "stealth", cost: 5000 },
                        { id: "traffic_disguise", name: "AI流量偽裝器", icon: "fa-mask", desc: "使用AI算法偽裝攻擊流量為正常業務流量", cooldown: 10, effect: "stealth", cost: 8000 },
                        { id: "proxy_chain", name: "多重動態代理鏈", icon: "fa-link", desc: "通過7層動態代理隱藏真實IP地址", cooldown: 6, effect: "stealth", cost: 6000 },
                        { id: "traffic_hider", name: "流量/身份隱藏器", icon: "fa-eye-slash", desc: "完全隱藏網絡流量和身份信息", cooldown: 12, effect: "stealth", cost: 15000 },
                        { id: "dynamic_jumpnet", name: "動態跳板網絡", icon: "fa-random", desc: "建立隨機路由的跳板網絡隱藏真實位置", cooldown: 15, effect: "stealth", cost: 20000 },
                        { id: "identity_hider", name: "身份隱藏器", icon: "fa-user-secret", desc: "完全隱藏真實身份信息", cooldown: 18, effect: "stealth", cost: 25000 },
                        { id: "traffic_encryptor", name: "流量加密器", icon: "fa-lock", desc: "完全加密所有網絡流量", cooldown: 14, effect: "stealth", cost: 22000 }
                    ],
                    counter_investigation: [
                        { id: "evidence_pollution", name: "智能證據污染攻擊", icon: "fa-virus", desc: "污染執法部門證據庫並植入混淆數據", cooldown: 15, effect: "counter", cost: 12000 },
                        { id: "analysis_jamming", name: "高級分析工具干擾", icon: "fa-bug", desc: "干擾執法部門的AI分析系統和機器學習模型", cooldown: 12, effect: "counter", cost: 10000 },
                        { id: "fake_command", name: "跨部門偽造協作指令", icon: "fa-file-signature", desc: "模仿執法系統向多部門發送虛假指令", cooldown: 20, effect: "counter", cost: 15000 },
                        { id: "data_injection", name: "數據注入攻擊", icon: "fa-syringe", desc: "向證據庫注入偽造數據污染證據鏈", cooldown: 18, effect: "counter", cost: 14000 },
                        { id: "signal_jammer", name: "協作頻道/信號干擾器", icon: "fa-wifi-slash", desc: "干擾執法部門的通訊和協作頻道", cooldown: 14, effect: "counter", cost: 16000 },
                        { id: "file_wiper", name: "文件擦除器", icon: "fa-trash", desc: "完全刪除系統痕跡和日誌", cooldown: 16, effect: "counter", cost: 18000 },
                        { id: "evidence_protector_breach", name: "證據保護系統破解", icon: "fa-shield-alt", desc: "破解證據保護系統", cooldown: 20, effect: "counter", cost: 20000 },
                        { id: "mass_contamination", name: "大規模證據污染攻擊", icon: "fa-biohazard", desc: "執行高級持久性污染攻擊污染所有證據", cooldown: 25, effect: "counter", cost: 30000 },
                        { id: "evidence_wiper", name: "證據徹底抹除器", icon: "fa-fire", desc: "徹底銷毀關鍵證據無法恢復", cooldown: 30, effect: "counter", cost: 40000 }
                    ],
                    attack: [
                        { id: "metasploit", name: "Metasploit框架", icon: "fa-crosshairs", desc: "利用已知系統漏洞進行精準攻擊", cooldown: 10, effect: "attack", cost: 10000 },
                        { id: "ddos", name: "DDoS攻擊集群", icon: "fa-bolt", desc: "發動大規模分散式阻斷服務攻擊", cooldown: 18, effect: "attack", cost: 20000 },
                        { id: "backdoor", name: "持久性後門植入", icon: "fa-door-open", desc: "創建多重隱藏後門維持持久訪問", cooldown: 15, effect: "attack", cost: 15000 },
                        { id: "data_wipe", name: "數據擦除攻擊", icon: "fa-trash", desc: "定向擦除執法部門證據庫數據", cooldown: 25, effect: "attack", cost: 30000 },
                        { id: "memory_attack", name: "記憶體無檔案攻擊套件", icon: "fa-memory", desc: "在記憶體中執行攻擊不留痕跡", cooldown: 20, effect: "attack", cost: 25000 },
                        { id: "server_cripple", name: "伺服器癱瘓攻擊", icon: "fa-server", desc: "針對性癱瘓執法部門伺服器", cooldown: 30, effect: "attack", cost: 40000 },
                        { id: "node_crippler", name: "網路節點癱瘓工具", icon: "fa-network-wired", desc: "癱瘓關鍵網絡節點和路由", cooldown: 22, effect: "attack", cost: 28000 },
                        { id: "ransomware", name: "高級勒索軟件", icon: "fa-lock", desc: "加密目標文件進行勒索", cooldown: 25, effect: "attack", cost: 35000 }
                    ],
                    infiltration: [
                        { id: "device_hack", name: "設備入侵", icon: "fa-laptop-code", desc: "入侵執法部門電腦和移動設備", cooldown: 16, effect: "infiltrate", cost: 18000 },
                        { id: "document_steal", name: "機密文件竊取", icon: "fa-file-steal", desc: "竊取執法部門機密文件和數據", cooldown: 20, effect: "infiltrate", cost: 22000 },
                        { id: "decryption_attack", name: "加密破解攻擊", icon: "fa-unlock-alt", desc: "破解加密文件和通訊", cooldown: 25, effect: "infiltrate", cost: 30000 },
                        { id: "browser_exploit", name: "瀏覽器漏洞利用", icon: "fa-window-maximize", desc: "利用瀏覽器漏洞獲取信息", cooldown: 14, effect: "infiltrate", cost: 16000 },
                        { id: "server_infiltration", name: "伺服器滲透", icon: "fa-server", desc: "深度滲透目標伺服器系統", cooldown: 22, effect: "infiltrate", cost: 28000 },
                        { id: "backdoor_implant", name: "持久後門植入", icon: "fa-door-closed", desc: "植入永久性後門系統", cooldown: 30, effect: "infiltrate", cost: 40000 }
                    ],
                    advanced: [
                        { id: "bait_server", name: "誘餌伺服器", icon: "fa-honey-pot", desc: "設置誘餌伺服器誤導追蹤", cooldown: 18, effect: "advanced", cost: 20000 },
                        { id: "fake_fingerprint", name: "偽造攻擊指紋工具", icon: "fa-fingerprint", desc: "偽造攻擊指紋和工具特徵", cooldown: 15, effect: "advanced", cost: 18000 },
                        { id: "phishing_generator", name: "社會工程釣魚生成器", icon: "fa-fish", desc: "生成釣魚攻擊和社會工程工具", cooldown: 12, effect: "advanced", cost: 15000 },
                        { id: "encryption_relay", name: "加密通道中繼器", icon: "fa-exchange-alt", desc: "建立加密中繼通道保護通訊", cooldown: 10, effect: "advanced", cost: 12000 },
                        { id: "hardware_spoof", name: "硬體指紋偽造器", icon: "fa-microchip", desc: "偽造硬體指紋和設備識別", cooldown: 16, effect: "advanced", cost: 22000 },
                        { id: "darknet_market", name: "暗網委託市場", icon: "fa-shopping-bag", desc: "訪問暗網市場購買黑市工具", cooldown: 30, effect: "advanced", cost: 50000 }
                    ],
                    server_management: [
                        { id: "server_console", name: "伺服器控制台", icon: "fa-terminal", desc: "打開伺服器管理控制台", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "server_status", name: "系統資源監控", icon: "fa-chart-line", desc: "查看 CPU、內存、磁碟使用狀況", cooldown: 2, effect: "server_mgmt", cost: 0 },
                        { id: "server_logs", name: "伺服器日誌查詢", icon: "fa-file-alt", desc: "查詢伺服器訪問記錄和錯誤日誌", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "server_terminal", name: "終端指令模擬", icon: "fa-code", desc: "執行模擬 Linux/Windows 指令", cooldown: 2, effect: "server_mgmt", cost: 0 },
                        { id: "service_control", name: "服務管理", icon: "fa-cogs", desc: "啟動/停止伺服器服務", cooldown: 5, effect: "server_mgmt", cost: 0 },
                        { id: "process_monitor", name: "進程監控", icon: "fa-tasks", desc: "查看和管理運行中的進程", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "network_monitor", name: "網絡連接監控", icon: "fa-network-wired", desc: "查看網絡連接和端口狀況", cooldown: 3, effect: "server_mgmt", cost: 0 }
                    ]
                },
                law_enforcement: {
                    investigation: [
                        { id: "digital_forensics", name: "高級數碼鑑識沙盒", icon: "fa-search", desc: "深度分析惡意軟件、攻擊工具及行為模式", cooldown: 5, effect: "investigate", cost: 8000 },
                        { id: "network_mapping", name: "實時網絡流量繪圖儀", icon: "fa-project-diagram", desc: "可視化網絡流量、連接關係及異常模式", cooldown: 6, effect: "investigate", cost: 10000 },
                        { id: "log_analyzer", name: "AI日誌分析系統", icon: "fa-file-alt", desc: "使用AI分析系統日誌尋找異常行為", cooldown: 4, effect: "investigate", cost: 6000 },
                        { id: "memory_forensics", name: "內存取證分析", icon: "fa-memory", desc: "分析系統內存中的惡意代碼殘留", cooldown: 7, effect: "investigate", cost: 12000 },
                        { id: "social_analyzer", name: "社交圖譜分析器", icon: "fa-users", desc: "分析社交網絡關聯和行為模式", cooldown: 8, effect: "investigate", cost: 15000 },
                        { id: "behavior_analysis", name: "行為模式分析", icon: "fa-brain", desc: "分析黑客行為模式預測下一步", cooldown: 9, effect: "investigate", cost: 13000 }
                    ],
                    tracking: [
                        { id: "social_graph", name: "社交圖譜關聯分析器", icon: "fa-users", desc: "分析社交網絡關聯、時間線及行為模式", cooldown: 8, effect: "track", cost: 15000 },
                        { id: "ip_tracker", name: "全球IP追蹤系統", icon: "fa-map-marker-alt", desc: "追蹤IP地址的地理位置、ISP及歷史記錄", cooldown: 7, effect: "track", cost: 12000 },
                        { id: "crypto_tracker", name: "區塊鏈加密貨幣追蹤", icon: "fa-coins", desc: "追蹤加密貨幣交易記錄及資金流向", cooldown: 10, effect: "track", cost: 20000 },
                        { id: "osint_collector", name: "OSINT情報收集器", icon: "fa-globe", desc: "收集公開來源情報及網絡足跡", cooldown: 5, effect: "track", cost: 8000 },
                        { id: "gps_tracker", name: "超強GPS衛星定位", icon: "fa-satellite", desc: "精確追蹤目標地理位置", cooldown: 12, effect: "track", cost: 25000 },
                        { id: "cctv_access", name: "CCTV監控訪問", icon: "fa-video", desc: "訪問和分析監控錄像", cooldown: 10, effect: "track", cost: 18000 },
                        { id: "blockchain_tracker", name: "區塊鏈追蹤系統", icon: "fa-link", desc: "深度追蹤加密貨幣交易鏈", cooldown: 15, effect: "track", cost: 30000 }
                    ],
                    defense: [
                        { id: "honeypot", name: "智能主動蜜罐系統", icon: "fa-bug", desc: "部署陷阱伺服器誘捕黑客並收集攻擊特徵", cooldown: 12, effect: "defend", cost: 25000 },
                        { id: "network_sweep", name: "網絡圍捕行動", icon: "fa-network-wired", desc: "壓縮黑客可用匿名節點及跳板網絡", cooldown: 15, effect: "defend", cost: 30000 },
                        { id: "traffic_intercept", name: "合法流量深度攔截", icon: "fa-shield-alt", desc: "攔截和分析可疑流量進行取證", cooldown: 8, effect: "defend", cost: 18000 },
                        { id: "server_hardening", name: "指揮中心強化", icon: "fa-server", desc: "加強指揮中心伺服器安全防護", cooldown: 10, effect: "defend", cost: 20000 },
                        { id: "signal_blocker", name: "阻擋防止幹擾信號", icon: "fa-wifi", desc: "防止通訊干擾和信號阻斷", cooldown: 14, effect: "defend", cost: 22000 },
                        { id: "emergency_shutdown", name: "緊急斷流", icon: "fa-power-off", desc: "緊急切斷可疑網絡連接", cooldown: 20, effect: "defend", cost: 28000 },
                        { id: "evidence_protector", name: "證據保護系統", icon: "fa-shield-alt", desc: "保護證據庫免受污染", cooldown: 16, effect: "defend", cost: 24000 },
                        { id: "ai_predictor", name: "AI行為預測系統", icon: "fa-robot", desc: "預測黑客下一步行動", cooldown: 18, effect: "defend", cost: 32000 },
                        { id: "contamination_detector", name: "智能污染檢測系統", icon: "fa-microscope", desc: "實時監測證據污染並生成警報", cooldown: 10, effect: "defend", cost: 22000 },
                        { id: "evidence_cleanser", name: "證據清潔與恢復系統", icon: "fa-droplet", desc: "深度清潔和恢復污染證據", cooldown: 18, effect: "defend", cost: 28000 },
                        { id: "identity_lock_enhancer", name: "三階層身份鎖定強化", icon: "fa-lock", desc: "強化技術/社交/實體三階層身份鎖定", cooldown: 12, effect: "defend", cost: 25000 }
                    ],
                    collaboration: [
                        { id: "department_coord", name: "跨部門指揮協調面板", icon: "fa-users-cog", desc: "協調多部門聯合調查與資源共享", cooldown: 10, effect: "collaborate", cost: 15000 },
                        { id: "interpol_request", name: "國際刑警協作請求", icon: "fa-globe", desc: "請求國際執法部門協助及資料共享", cooldown: 20, effect: "collaborate", cost: 35000 },
                        { id: "warrant_request", name: "逮捕令申請系統", icon: "fa-file-contract", desc: "申請正式逮捕令及司法授權", cooldown: 25, effect: "collaborate", cost: 40000 },
                        { id: "joint_operation", name: "聯合行動協調", icon: "fa-handshake", desc: "組織跨部門聯合執法行動", cooldown: 30, effect: "collaborate", cost: 50000 },
                        { id: "command_panel", name: "跨部門指揮面板", icon: "fa-tv", desc: "協調多部門指揮和資源分配", cooldown: 12, effect: "collaborate", cost: 18000 },
                        { id: "resource_allocator", name: "資源分配系統", icon: "fa-cogs", desc: "智能分配部門資源", cooldown: 14, effect: "collaborate", cost: 20000 },
                        { id: "joc_center", name: "聯合任務中心", icon: "fa-building", desc: "啟動多部門聯合任務中心", cooldown: 30, effect: "collaborate", cost: 45000 }
                    ],
                    forensics: [
                        { id: "evidence_hash_verify", name: "證據完整性驗證", icon: "fa-certificate", desc: "計算並驗證MD5/SHA256哈希值確保證據完整", cooldown: 10, effect: "forensics", cost: 12000 },
                        { id: "chain_of_custody", name: "監管鏈記錄系統", icon: "fa-link", desc: "記錄證據從收集到呈堂的完整監管日誌", cooldown: 12, effect: "forensics", cost: 15000 },
                        { id: "contamination_prevention", name: "主動污染防護", icon: "fa-shield-virus", desc: "啟動實時監控防止證據被污染", cooldown: 15, effect: "forensics", cost: 18000 },
                        { id: "wireshark_simulator", name: "Wireshark網路分析", icon: "fa-ethernet", desc: "進行即時網路封包分析和取證", cooldown: 16, effect: "forensics", cost: 22000 },
                        { id: "ftk_forensics", name: "FTK數碼鑑識", icon: "fa-hard-drive", desc: "使用FTK進行高級數碼取證分析", cooldown: 18, effect: "forensics", cost: 28000 }
                    ],
                    skills: [
                        { id: "skill_upgrade", name: "技能升級面板", icon: "fa-trophy", desc: "升級個人技能提升調查和防禦能力", cooldown: 20, effect: "skills", cost: 25000 },
                        { id: "equipment_management", name: "裝備管理系統", icon: "fa-toolbox", desc: "查看、購買和裝備專業工具和防衛裝備", cooldown: 15, effect: "skills", cost: 20000 },
                        { id: "level_up_check", name: "等級晉升檢驗", icon: "fa-graduation-cap", desc: "檢查升級進度和解鎖新能力", cooldown: 10, effect: "skills", cost: 10000 }
                    ],
                    decryption: [
                        { id: "password_cracker", name: "破解裝置加密密碼", icon: "fa-unlock", desc: "強制破解加密設備和文件", cooldown: 18, effect: "decrypt", cost: 32000 },
                        { id: "intercept_key", name: "合法攔截密鑰", icon: "fa-key", desc: "獲取合法攔截加密通訊的權限", cooldown: 25, effect: "decrypt", cost: 45000 },
                        { id: "decryption_suite", name: "高級解密套件", icon: "fa-code", desc: "解密各類加密文件和通訊", cooldown: 20, effect: "decrypt", cost: 38000 },
                        { id: "threat_analysis", name: "全網威脅感測器", icon: "fa-radar", desc: "檢測和分析全網威脅", cooldown: 15, effect: "decrypt", cost: 28000 },
                        { id: "encryption_breaker", name: "加密破解系統", icon: "fa-unlock-alt", desc: "深度破解高級加密系統", cooldown: 22, effect: "decrypt", cost: 40000 }
                    ],
                    attack: [
                        { id: "counter_attack", name: "反擊系統", icon: "fa-crosshairs", desc: "對黑客發動反擊", cooldown: 30, effect: "attack", cost: 50000 },
                        { id: "backtrace", name: "反向追蹤攻擊", icon: "fa-search-location", desc: "反向追蹤黑客位置", cooldown: 25, effect: "attack", cost: 45000 },
                        { id: "system_lockdown", name: "系統鎖定", icon: "fa-lock", desc: "鎖定黑客系統", cooldown: 20, effect: "attack", cost: 35000 },
                        { id: "rapid_response", name: "快速反應攻擊", icon: "fa-bolt", desc: "快速反應對黑客系統造成傷害", cooldown: 18, effect: "attack", cost: 30000 }
                    ],
                    server_management: [
                        { id: "server_console", name: "指揮中心控制台", icon: "fa-terminal", desc: "打開指揮中心管理控制台", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "server_status", name: "系統資源監控", icon: "fa-chart-line", desc: "查看 CPU、內存、磁碟使用狀況", cooldown: 2, effect: "server_mgmt", cost: 0 },
                        { id: "server_logs", name: "系統日誌查詢", icon: "fa-file-alt", desc: "查詢系統訪問記錄和事件日誌", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "server_terminal", name: "終端指令模擬", icon: "fa-code", desc: "執行模擬系統指令", cooldown: 2, effect: "server_mgmt", cost: 0 },
                        { id: "service_control", name: "服務管理", icon: "fa-cogs", desc: "啟動/停止系統服務", cooldown: 5, effect: "server_mgmt", cost: 0 },
                        { id: "process_monitor", name: "進程監控", icon: "fa-tasks", desc: "查看和管理系統進程", cooldown: 3, effect: "server_mgmt", cost: 0 },
                        { id: "network_monitor", name: "網絡連接監控", icon: "fa-network-wired", desc: "查看網絡連接和端口狀況", cooldown: 3, effect: "server_mgmt", cost: 0 }
                    ]
                }
            },
            
            // 證據類型定義
            evidenceTypes: [
                { id: 'ip_logs', name: 'IP訪問日誌', category: 'technical', critical: false, value: 5 },
                { id: 'malware_sample', name: '惡意軟件樣本', category: 'technical', critical: true, value: 15 },
                { id: 'vpn_logs', name: 'VPN連接記錄', category: 'technical', critical: false, value: 8 },
                { id: 'social_post', name: '社交媒體發文', category: 'social', critical: false, value: 7 },
                { id: 'online_profile', name: '網絡身份檔案', category: 'social', critical: true, value: 12 },
                { id: 'crypto_transaction', name: '加密貨幣交易', category: 'social', critical: true, value: 18 },
                { id: 'device_fingerprint', name: '設備指紋', category: 'physical', critical: false, value: 10 },
                { id: 'location_data', name: '地理位置數據', category: 'physical', critical: true, value: 20 },
                { id: 'payment_record', name: '支付記錄', category: 'physical', critical: true, value: 25 },
                { id: 'browser_history', name: '瀏覽器歷史記錄', category: 'technical', critical: false, value: 6 },
                { id: 'email_record', name: '電子郵件記錄', category: 'social', critical: true, value: 15 },
                { id: 'device_spec', name: '設備規格信息', category: 'technical', critical: false, value: 8 },
                { id: 'network_traffic', name: '網絡流量數據', category: 'technical', critical: true, value: 22 },
                { id: 'encryption_key', name: '加密密鑰片段', category: 'technical', critical: true, value: 30 }
            ],
            
            // 動態情報類型
            intelTypes: [
                { id: 'ip_leak', name: 'IP地址洩露', category: 'technical', real: true },
                { id: 'social_leak', name: '社交媒體活動', category: 'social', real: true },
                { id: 'device_info', name: '設備信息', category: 'technical', real: true },
                { id: 'location_hint', name: '位置提示', category: 'physical', real: true },
                { id: 'fake_ip', name: '偽造IP地址', category: 'technical', real: false },
                { id: 'fake_social', name: '偽造社交資料', category: 'social', real: false },
                { id: 'fake_device', name: '偽造設備信息', category: 'technical', real: false },
                { id: 'fake_location', name: '偽造位置信息', category: 'physical', real: false }
            ],
            
            // 機密文件類型
            documentTypes: [
                { id: 'investigation_report', name: '調查報告', value: 50, encrypted: true },
                { id: 'warrant_docs', name: '逮捕令文件', value: 75, encrypted: true },
                { id: 'agent_list', name: '特工名單', value: 100, encrypted: true },
                { id: 'system_blueprint', name: '系統藍圖', value: 60, encrypted: true },
                { id: 'encryption_keys', name: '加密密鑰庫', value: 90, encrypted: true },
                { id: 'operation_plans', name: '行動計劃', value: 80, encrypted: true }
            ],
            
            // 被入侵設備類型
            deviceTypes: [
                { id: 'police_laptop', name: '警用筆記本電腦', os: 'Windows 11', specs: 'i7, 16GB RAM, 512GB SSD' },
                { id: 'server_rack', name: '伺服器機架', os: 'Linux Server', specs: 'Dual Xeon, 64GB RAM, 10TB RAID' },
                { id: 'mobile_device', name: '移動設備', os: 'Android/iOS', specs: 'Various models' },
                { id: 'network_router', name: '網絡路由器', os: 'Custom Firmware', specs: 'Enterprise grade' },
                { id: 'surveillance_cam', name: '監控攝像頭', os: 'Embedded Linux', specs: '4K, Night vision' }
            ],
            
            // 任務目標
            missions: {
                hacker: [
                    { id: 'stealth_high', name: '保持隱蔽度 > 80%', status: 'incomplete' },
                    { id: 'footprints_low', name: '數碼足跡 < 3', status: 'incomplete' },
                    { id: 'decrypt_docs', name: '解密至少2份機密文件', status: 'incomplete' },
                    { id: 'compromise_devices', name: '入侵至少3台設備', status: 'incomplete' },
                    { id: 'pollute_evidence', name: '污染至少5項證據', status: 'incomplete' }
                ],
                law_enforcement: [
                    { id: 'identity_lock', name: '三階層身份鎖定 > 80%', status: 'incomplete' },
                    { id: 'critical_evidence', name: '收集至少3項關鍵證據', status: 'incomplete' },
                    { id: 'verify_intel', name: '驗證至少5條情報', status: 'incomplete' },
                    { id: 'coordinate_depts', name: '協調所有部門', status: 'incomplete' },
                    { id: 'arrest_warrant', name: '申請逮捕令', status: 'incomplete' }
                ]
            }
        };

        // ===== 頁面導航函數 =====
        function goToMainPage() {
            showPage('main-page');
            GameState.currentPage = 'main';
            updateNavActive();
        }

        function showSetupPage() {
            if (!GameState.currentRole) {
                showNotification('請先選擇角色', '請返回主頁選擇黑客或執法部門角色。', 'warning');
                return;
            }
            
            showPage('season2-setup-page');
            GameState.currentPage = 'setup';
            updateNavActive();
            updateSetupPage();
        }

        function showGamePage() {
            showPage('game-page');
            GameState.currentPage = 'game';
            updateNavActive();
        }

        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
                page.style.display = 'block';
                window.scrollTo(0, 0);
            }
        }

        function updateNavActive() {
            const navItems = document.querySelectorAll('.nav-menu li a');
            navItems.forEach(item => item.classList.remove('active'));
            
            switch(GameState.currentPage) {
                case 'main':
                    document.getElementById('nav-home').classList.add('active');
                    break;
                case 'setup':
                    document.getElementById('nav-season2').classList.add('active');
                    break;
                case 'game':
                    document.getElementById('nav-season2').classList.add('active');
                    break;
            }
        }

        // ===== 角色選擇函數 =====
        function selectRole(role) {
            GameState.currentRole = role;
            
            if (role === 'hacker') {
                showNotification('角色選擇確認', '你已選擇扮演黑客。你的目標是隱藏身份、反制調查，並逃脫執法部門的追捕。', 'hacker');
            } else if (role === 'law_enforcement') {
                showNotification('角色選擇確認', '你已選擇扮演執法部門。你的目標是調查黑客身份、收集證據鏈，並申請逮捕令進行拘捕。', 'law_enforcement');
            }
            
            showSetupPage();
        }

        // ===== 設置頁面更新 =====
        function updateSetupPage() {
            const roleDisplay = document.getElementById('selected-role-display');
            const roleName = document.getElementById('selected-role-name');
            const roleDesc = document.getElementById('selected-role-desc');
            const setupTitle = document.getElementById('setup-title');
            const setupSubtitle = document.getElementById('setup-subtitle');
            
            if (GameState.currentRole === 'hacker') {
                roleDisplay.style.borderColor = '#00ff41';
                roleName.innerHTML = '<i class="fas fa-user-secret"></i> 黑客角色';
                roleName.style.color = '#00ff41';
                roleDesc.textContent = '隱藏身份、清除足跡、反制調查、逃脫追捕、入侵系統';
                setupTitle.textContent = '黑客對戰設置';
                setupSubtitle.textContent = '配置你的黑客對戰參數';
            } else if (GameState.currentRole === 'law_enforcement') {
                roleDisplay.style.borderColor = '#4a90d9';
                roleName.innerHTML = '<i class="fas fa-shield-alt"></i> 執法部門角色';
                roleName.style.color = '#4a90d9';
                roleDesc.textContent = '調查身份、收集證據、鎖定目標、申請逮捕令、保護系統';
                setupTitle.textContent = '執法部門對戰設置';
                setupSubtitle.textContent = '配置你的執法調查參數';
            } else {
                roleDisplay.style.borderColor = '#666';
                roleName.innerHTML = '<i class="fas fa-question-circle"></i> 尚未選擇角色';
                roleName.style.color = '#666';
                roleDesc.textContent = '請返回主頁選擇角色';
            }
            
            // 設置預設對手IP
            if (GameState.currentRole === 'hacker') {
                document.getElementById('opponent-ip').value = '10.0.0.1';
                document.getElementById('opponent-ip').placeholder = '執法部門指揮中心 IP (例: 10.0.0.1)';
            } else {
                document.getElementById('opponent-ip').value = '192.168.1.200';
                document.getElementById('opponent-ip').placeholder = '黑客IP地址 (例: 192.168.1.200)';
            }
            
            // 選擇難度
            selectDifficulty('professional');
        }

        // ===== 數值驗證與限制函數 =====
        function clampValue(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function validateGameStats() {
            const hacker = GameState.playerData.hacker;
            const le = GameState.playerData.law_enforcement;
            
            // 黑客數據驗證
            hacker.stealth = Math.max(0, Math.min(100, hacker.stealth));
            hacker.encryptionLevel = Math.max(0, Math.min(100, hacker.encryptionLevel));
            hacker.digitalFootprints = Math.max(0, hacker.digitalFootprints);
            hacker.serverHealth = Math.max(0, Math.min(100, hacker.serverHealth));
            hacker.deviceHealth = Math.max(0, Math.min(100, hacker.deviceHealth));
            hacker.controlProgress = Math.max(0, Math.min(100, hacker.controlProgress));
            
            // 執法部門數據驗證
            le.investigationProgress = Math.max(0, Math.min(100, le.investigationProgress));
            le.identityLock.technical = Math.max(0, Math.min(100, le.identityLock.technical));
            le.identityLock.social = Math.max(0, Math.min(100, le.identityLock.social));
            le.identityLock.physical = Math.max(0, Math.min(100, le.identityLock.physical));
            le.warrantProgress = Math.max(0, Math.min(100, le.warrantProgress));
            le.serverHealth = Math.max(0, Math.min(100, le.serverHealth));
            le.evidenceLibraryHealth = Math.max(0, Math.min(100, le.evidenceLibraryHealth));
            le.analysisToolsHealth = Math.max(0, Math.min(100, le.analysisToolsHealth));
        }

        function selectDifficulty(level, el) {
            const cards = document.querySelectorAll('.difficulty-card');
            cards.forEach(card => card.classList.remove('selected'));

            // If an element is provided (from onclick), mark it selected; otherwise find by data-level
            if (el && el.classList) {
                el.classList.add('selected');
            } else {
                const target = document.querySelector('.difficulty-card[data-level="' + level + '"]');
                if (target) target.classList.add('selected');
            }

            GameState.difficulty = level;

            // 延長遊戲時間：20-30分鐘
            switch(level) {
                case 'rookie':
                    GameState.gameTimeLimit = 1800; // 30分鐘
                    break;
                case 'professional':
                    GameState.gameTimeLimit = 1500; // 25分鐘
                    break;
                case 'elite':
                    GameState.gameTimeLimit = 1200; // 20分鐘
                    break;
                case 'legendary':
                    GameState.gameTimeLimit = 900; // 15分鐘
                    break;
            }
        }

        // ===== 開始對戰函數 =====
        function startSeason2Battle() {
            const opponentIP = document.getElementById('opponent-ip').value.trim();
            
            if (!opponentIP) {
                showNotification('輸入錯誤', '請輸入對手的IP地址。', 'warning');
                return;
            }
            
            if (!GameState.currentRole) {
                showNotification('角色未選擇', '請返回主頁選擇角色。', 'warning');
                return;
            }
            
            GameState.opponentIP = opponentIP;
            GameState.gameActive = true; GameState.logs = { system: [], security: [], communication: [] }; GameState.topologyNodes = [];
            GameState.gameStartTime = Date.now();
            GameState.connectionStatus = 'connected';
            
            // 根據角色初始化遊戲數據
            if (GameState.currentRole === 'hacker') {
                GameState.playerData.hacker.money = 150000;
                GameState.playerData.hacker.stealth = 60;
                GameState.playerData.hacker.encryptionLevel = 40;
                GameState.playerData.hacker.digitalFootprints = 5;
                GameState.playerData.hacker.compromisedEvidence = 0;
                GameState.playerData.hacker.controlProgress = 0;
                GameState.playerData.hacker.serverHealth = 100;
                GameState.playerData.hacker.deviceHealth = 100;
                GameState.playerData.hacker.stolenDocuments = [];
                GameState.playerData.hacker.decryptionProgress = 0;
                GameState.playerData.hacker.compromisedDevices = [];
                GameState.playerData.hacker.darknetCredits = 0;
                GameState.playerData.hacker.activeVpnNodes = 3;
                GameState.playerData.hacker.signalJamming = false;
                GameState.playerData.hacker.realtimeIntel = [];
                
                // 初始化任務
                GameState.missions.hacker.forEach(mission => mission.status = 'incomplete');
                
                // 初始化對手數據 (執法部門AI)
                GameState.opponentData.law_enforcement.budget = 200000;
                GameState.opponentData.law_enforcement.investigationProgress = 0;
                GameState.opponentData.law_enforcement.identityLock = { technical: 0, social: 0, physical: 0 };
                GameState.opponentData.law_enforcement.evidenceChain = [];
                GameState.opponentData.law_enforcement.warrantProgress = 0;
                GameState.opponentData.law_enforcement.warrantIssued = false;
                GameState.opponentData.law_enforcement.serverHealth = 100;
                GameState.opponentData.law_enforcement.evidenceLibraryHealth = 100;
                GameState.opponentData.law_enforcement.analysisToolsHealth = 100;
                GameState.opponentData.law_enforcement.dynamicIntel = [];
                GameState.opponentData.law_enforcement.networkSweepActive = false;
            } else {
                GameState.playerData.law_enforcement.budget = 200000;
                GameState.playerData.law_enforcement.investigationProgress = 0;
                GameState.playerData.law_enforcement.identityLock = { technical: 0, social: 0, physical: 0 };
                GameState.playerData.law_enforcement.evidenceChain = [];
                GameState.playerData.law_enforcement.criticalEvidence = [];
                GameState.playerData.law_enforcement.warrantProgress = 0;
                GameState.playerData.law_enforcement.warrantIssued = false;
                GameState.playerData.law_enforcement.serverHealth = 100;
                GameState.playerData.law_enforcement.evidenceLibraryHealth = 100;
                GameState.playerData.law_enforcement.analysisToolsHealth = 100;
                GameState.playerData.law_enforcement.dynamicIntel = [];
                GameState.playerData.law_enforcement.verifiedIntel = [];
                GameState.playerData.law_enforcement.networkSweepActive = false;
                GameState.playerData.law_enforcement.activeHoneypots = 0;
                GameState.playerData.law_enforcement.compromisedDevices = [];
                GameState.playerData.law_enforcement.gpsTracking = false;
                GameState.playerData.law_enforcement.signalBlocking = false;
                GameState.playerData.law_enforcement.realtimeTracking = [];
                
                // 初始化任務
                GameState.missions.law_enforcement.forEach(mission => mission.status = 'incomplete');
                
                // 初始化對手數據 (黑客AI)
                GameState.opponentData.hacker.money = 180000;
                GameState.opponentData.hacker.stealth = 70;
                GameState.opponentData.hacker.encryptionLevel = 50;
                GameState.opponentData.hacker.digitalFootprints = 5;
                GameState.opponentData.hacker.compromisedEvidence = 0;
                GameState.opponentData.hacker.controlProgress = 0;
                GameState.opponentData.hacker.serverHealth = 100;
                GameState.opponentData.hacker.deviceHealth = 100;
                GameState.opponentData.hacker.stolenDocuments = [];
                GameState.opponentData.hacker.activeVpnNodes = 4;
            }
            
            showGamePage();
            initializeGameUI(); initNetworkTopology();
            startGameTimer();
            
            // 顯示歡迎訊息
            if (GameState.currentRole === 'hacker') {
                addTerminalLine('[系統] 第二季對戰開始 - 黑客模式', 'system');
                addTerminalLine('[系統] 目標: 執法部門指揮中心 (' + GameState.opponentIP + ')', 'system');
                addTerminalLine('[系統] 你的任務: 隱藏身份、清除數碼足跡、逃脫追捕、入侵系統', 'system');
                addTerminalLine('[提示] 使用工具分類中的工具執行操作', 'warning');
                addTerminalLine('[提示] 倒計時: ' + Math.floor(GameState.gameTimeLimit / 60) + '分鐘', 'alert');
            } else {
                addTerminalLine('[系統] 第二季對戰開始 - 執法部門模式', 'system');
                addTerminalLine('[系統] 目標: 黑客 (' + GameState.opponentIP + ')', 'system');
                addTerminalLine('[系統] 你的任務: 調查黑客身份、收集證據、申請逮捕令、保護系統', 'system');
                addTerminalLine('[提示] 使用工具分類中的工具執行調查', 'warning');
                addTerminalLine('[提示] 倒計時: ' + Math.floor(GameState.gameTimeLimit / 60) + '分鐘', 'alert');
            }
            
            // 生成初始動態情報
            generateDynamicIntel();
            
            // 初始目標信息
            updateTargetRealtimeInfo();
            
            // ===== 初始化新系統 =====
            initializeSkillTree();
            initializeEquipmentSystem();
            initializeAutoSave();
            initializeEvidenceIntegrity();
            
            addTerminalLine('[系統] 新系統已激活: 技能樹、裝備系統、自動存檔、證據驗證', 'success');
        }

        // ===== 遊戲UI初始化 =====
        function addTerminalLine(message, type = 'response') {
            const output = document.getElementById('terminal-output');
            if (!output) return;
            
            const line = document.createElement('div');
            line.className = 'terminal-line ' + (type || 'response');
            line.textContent = message;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            const titleEl = document.getElementById('notification-title-text');
            const messageEl = document.getElementById('notification-message');
            
            if (titleEl) titleEl.textContent = title;
            if (messageEl) messageEl.textContent = message;
            
            notification.className = 'notification show ' + type;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // --- 國際協作系統 ---
        function requestInternationalSupport() {
            const le = GameState.playerData.law_enforcement;
            if (le.budget < 50000) {
                showNotification('預算不足', '請求國際協作需要 50,000 預算。', 'warning');
                return;
            }
            openStepModal('國際協作請求', [
                { name: '選擇協作機構', type: 'select', options: [{label:'國際刑警 (Interpol)', value:'interpol'}, {label:'歐洲刑警 (Europol)', value:'europol'}] },
                { name: '發送情報共享請求', type: 'progress', duration: 3000 },
                { name: '等待全球數據庫比對', type: 'progress', duration: 5000 },
                { name: '獲取跨境追蹤權限', type: 'result', content: '協作成功！獲取黑客跨境 VPN 節點真實來源。' }
            ], (data) => {
                le.budget -= 50000;
                GameState.internationalSupport = true;
                le.identityLock.technical += 20;
                addTerminalLine('國際協作已激活：跨境追蹤能力提升。', 'success');
                addGameLog('system', '國際協作機構：' + data.selectedValue + ' 已介入');
            });
        }

        // --- 虛擬身份模擬系統 ---
        function createVirtualIdentity() {
            const hacker = GameState.playerData.hacker;
            if (hacker.money < 20000) {
                showNotification('資金不足', '創建虛擬身份需要 20,000 資金。', 'warning');
                return;
            }
            openStepModal('創建多重虛擬身份', [
                { name: '配置身份背景', type: 'form', fields: [{id:'alias', label:'代號'}, {id:'region', label:'虛擬地區'}] },
                { name: '生成社交足跡', type: 'progress', duration: 4000 },
                { name: '注入虛假數據', type: 'progress', duration: 3000 },
                { name: '身份激活', type: 'result', content: '虛擬身份已就緒，將有效分散執法部門調查壓力。' }
            ], (data) => {
                hacker.money -= 20000;
                const newId = { alias: data.formData.alias, stealth: 30 };
                GameState.identities.push(newId);
                hacker.stealth += 15;
                addTerminalLine('虛擬身份「' + data.formData.alias + '」已激活。', 'success');
            });
        }

        // --- 法庭證據提交系統 ---
        function startCourtPhase() {
            const le = GameState.playerData.law_enforcement;
            if (le.evidenceChain.length < 5) {
                showNotification('證據不足', '提交法庭至少需要 5 件證據。', 'warning');
                return;
            }
            GameState.courtPhase = true;
            openStepModal('法庭證據提交與審核', [
                { name: '整理證據鏈', type: 'check', items: le.evidenceChain.map(e => ({id: e.id, label: e.name, checked: true})) },
                { name: '法庭辯論模擬', type: 'progress', duration: 6000 },
                { name: '法官最終裁定', type: 'result', content: '證據確鑿，法庭簽發最終逮捕執行令！' }
            ], (data) => {
                if (le.identityLock.physical >= 80) {
                    endGameWithAnimation('law_enforcement', '法庭審核通過：黑客已被依法定罪並逮捕。');
                } else {
                    addTerminalLine('法庭審核通過，但仍需鎖定黑客物理位置。', 'info');
                }
            });
        }

        // --- 數據污染偵測 ---
        function detectContamination() {
            const le = GameState.playerData.law_enforcement;
            addTerminalLine('啟動數據污染偵測系統...', 'info');
            setTimeout(() => {
                const contaminated = le.evidenceChain.filter(e => e.contaminated);
                if (contaminated.length > 0) {
                    showNotification('偵測到污染', `發現 ${contaminated.length} 件證據已被黑客污染！`, 'danger');
                    contaminated.forEach(e => e.name += ' [已污染]');
                } else {
                    showNotification('系統安全', '未發現證據污染跡象。', 'success');
                }
                updateSpecialPanel();
            }, 2000);
        }

        // --- 證據清潔與恢復系統 ---
        function cleanseEvidence() {
            const le = GameState.playerData.law_enforcement;
            addTerminalLine('啟動證據清潔與恢復系統...', 'info');
            setTimeout(() => {
                const contaminated = le.evidenceChain.filter(e => e.contaminated);
                if (contaminated.length > 0) {
                    // 清潔污染的證據
                    contaminated.forEach(e => {
                        e.contaminated = false;
                        // 移除 [已污染] 標記
                        e.name = e.name.replace(' [已污染]', '');
                    });
                    showNotification('清潔成功', `已成功清潔 ${contaminated.length} 件污染的證據！`, 'success');
                    addTerminalLine(`[系統] 成功清潔 ${contaminated.length} 件證據，恢復原始信息完整性。`, 'success');
                } else {
                    showNotification('無需清潔', '未發現污染的證據，系統保持乾淨。', 'info');
                }
                updateSpecialPanel();
                updateGameStats();
            }, 2000);
        }

        // --- 突發事件系統 ---
        function triggerRandomEvent() {
            if (!GameState.gameActive) return;
            const events = [
                { name: '服務器故障', effect: () => { GameState.playerData.law_enforcement.serverHealth -= 10; addTerminalLine('突發：執法部門服務器出現硬件故障！', 'warning'); } },
                { name: '線人情報', effect: () => { GameState.playerData.law_enforcement.investigationProgress += 15; addTerminalLine('突發：匿名線人提供了關鍵情報！', 'success'); } },
                { name: '網絡風暴', effect: () => { GameState.playerData.hacker.stealth -= 10; addTerminalLine('突發：全球網絡波動，黑客隱蔽度下降！', 'warning'); } }
            ];
            if (Math.random() < 0.05) { // 5% 機率觸發
                const event = events[Math.floor(Math.random() * events.length)];
                event.effect();
            }
        }

        
        function updateReputation() {
            const hacker = GameState.playerData.hacker;
            const le = GameState.playerData.law_enforcement;
            GameState.reputation.hacker = Math.floor(hacker.compromisedDevices.length * 10 + hacker.stolenDocuments.length * 20);
            GameState.reputation.le = Math.floor(le.evidenceChain.length * 5 + (le.identityLock.technical + le.identityLock.social + le.identityLock.physical) / 3);
            const repEl = document.getElementById('reputation-display');
            if (repEl) repEl.innerText = '聲譽: ' + (GameState.currentRole === 'hacker' ? GameState.reputation.hacker : GameState.reputation.le);
        }
        // --- 資源消耗機制 ---
        function consumeResource(role, amount) {
            GameState.resources[role] -= amount;
            if (GameState.resources[role] < 0) GameState.resources[role] = 0;
            updateResourceUI();
        }

        function updateResourceUI() {
            const hackerRes = document.getElementById('hacker-resource-fill');
            const leRes = document.getElementById('le-resource-fill');
            if (hackerRes) hackerRes.style.width = (GameState.resources.hacker / 10) + '%';
            if (leRes) leRes.style.width = (GameState.resources.le / 10) + '%';
        }
    
        // --- 分步流程工具邏輯 ---
        function openStepModal(title, steps, onComplete) {
            const modal = document.getElementById('step-modal');
            const titleEl = document.getElementById('step-modal-title');
            const contentEl = document.getElementById('step-modal-content');
            const buttonsEl = document.getElementById('step-modal-buttons');
            
            GameState.currentStepTask = { steps, currentStep: 0, onComplete };
            titleEl.innerText = title;
            modal.classList.add('active');
            renderStep();
        }

        function closeStepModal() {
            document.getElementById('step-modal').classList.remove('active');
            GameState.currentStepTask = null;
        }

        function renderStep() {
            const task = GameState.currentStepTask;
            const step = task.steps[task.currentStep];
            const contentEl = document.getElementById('step-modal-content');
            const buttonsEl = document.getElementById('step-modal-buttons');
            
            let html = `<div class="step-item">
                <div style="margin-bottom:10px;"><strong>步驟 ${task.currentStep + 1}/${task.steps.length}: ${step.name}</strong></div>
                <div id="step-action-area">`;
            
            if (step.type === 'select') {
                html += `<select id="step-select" class="setting-input" style="width:100%">
                    ${step.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('')}
                </select>`;
            } else if (step.type === 'progress') {
                html += `<div class="step-progress-container"><div id="step-progress-fill" class="step-progress-fill"></div></div>
                         <div id="step-progress-text" style="font-size:0.8rem; text-align:center;">準備中...</div>`;
            } else if (step.type === 'form') {
                html += step.fields.map(f => `
                    <div style="margin-bottom:10px;">
                        <label style="font-size:0.8rem;">${f.label}</label>
                        <input type="${f.inputType || 'text'}" id="step-field-${f.id}" class="setting-input" style="width:100%" value="${f.value || ''}">
                    </div>
                `).join('');
            } else if (step.type === 'check') {
                html += step.items.map(item => `
                    <div style="margin-bottom:5px;">
                        <input type="checkbox" id="step-check-${item.id}" ${item.checked ? 'checked' : ''}>
                        <label style="font-size:0.8rem;">${item.label}</label>
                    </div>
                `).join('');
            } else if (step.type === 'result') {
                html += `<div style="color:#00ff41; font-family:monospace;">${step.content}</div>`;
            }
            
            html += `</div></div>`;
            contentEl.innerHTML = html;
            
            buttonsEl.innerHTML = `
                <button class="modal-btn modal-btn-confirm" id="step-next-btn" onclick="processCurrentStep()">
                    ${task.currentStep === task.steps.length - 1 ? '完成' : '下一步'}
                </button>
            `;
            
            if (step.type === 'progress') {
                document.getElementById('step-next-btn').disabled = true;
                simulateProgress(step.duration || 2000, () => {
                    document.getElementById('step-next-btn').disabled = false;
                });
            }
        }

        function simulateProgress(duration, callback) {
            const fill = document.getElementById('step-progress-fill');
            const text = document.getElementById('step-progress-text');
            let start = null;
            function animate(timestamp) {
                if (!start) start = timestamp;
                let progress = (timestamp - start) / duration;
                if (progress > 1) progress = 1;
                if (fill) fill.style.width = (progress * 100) + '%';
                if (text) text.innerText = Math.floor(progress * 100) + '%';
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    if (callback) callback();
                }
            }
            requestAnimationFrame(animate);
        }

        function processCurrentStep() {
            const task = GameState.currentStepTask;
            const step = task.steps[task.currentStep];
            
            // 收集數據
            if (step.type === 'select') {
                step.selectedValue = document.getElementById('step-select').value;
            } else if (step.type === 'form') {
                step.formData = {};
                step.fields.forEach(f => {
                    step.formData[f.id] = document.getElementById('step-field-' + f.id).value;
                });
            } else if (step.type === 'check') {
                step.checkedItems = step.items.filter(item => document.getElementById('step-check-' + item.id).checked);
            }
            
            if (task.currentStep < task.steps.length - 1) {
                task.currentStep++;
                renderStep();
            } else {
                const finalData = task.steps.reduce((acc, s) => ({...acc, ...s}), {});
                task.onComplete(finalData);
                closeStepModal();
            }
        }

        // --- 網絡拓撲圖邏輯 ---
        function initNetworkTopology() {
            const container = document.getElementById('network-topology-container');
            if (!container) return;
            
            const nodes = [
                { id: 'hacker_vpn', label: 'VPN節點', x: 50, y: 50, type: 'hacker' },
                { id: 'hacker_jump', label: '跳板伺服器', x: 150, y: 100, type: 'hacker' },
                { id: 'le_center', label: '指揮中心', x: 350, y: 150, type: 'le' },
                { id: 'le_db', label: '證據庫', x: 450, y: 50, type: 'le' }
            ];
            
            GameState.topologyNodes = nodes;
            renderTopology();
        }

        function renderTopology() {
            const container = document.getElementById('network-topology-container');
            if (!container) return;
            container.innerHTML = '';
            
            GameState.topologyNodes.forEach(node => {
                const nodeEl = document.createElement('div');
                nodeEl.className = `node ${node.type === 'hacker' ? 'hacker' : ''}`;
                nodeEl.style.left = node.x + 'px';
                nodeEl.style.top = node.y + 'px';
                nodeEl.innerHTML = `<i class="fas ${node.type === 'hacker' ? 'fa-user-secret' : 'fa-shield-alt'}"></i>
                                    <div class="node-label">${node.label}</div>`;
                nodeEl.onclick = () => showNotification(node.label, `IP: 10.0.0.${Math.floor(Math.random()*255)}\n狀態: 運行中\n資源佔用: ${Math.floor(Math.random()*40+10)}%`);
                container.appendChild(nodeEl);
            });
        }

        function triggerTopologyEffect(fromId, toId) {
            const container = document.getElementById('network-topology-container');
            const from = GameState.topologyNodes.find(n => n.id === fromId);
            const to = GameState.topologyNodes.find(n => n.id === toId);
            if (!from || !to) return;
            
            const line = document.createElement('div');
            line.className = 'connection-line active';
            const dx = to.x - from.x;
            const dy = to.y - from.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            line.style.width = dist + 'px';
            line.style.left = (from.x + 20) + 'px';
            line.style.top = (from.y + 20) + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);
            setTimeout(() => line.remove(), 2000);
        }

        // --- 日誌監控邏輯 ---
        function addGameLog(type, message) {
            const time = new Date().toLocaleTimeString();
            const logEntry = `[${time}] ${message}`;
            GameState.logs[type].push(logEntry);
            if (GameState.logs[type].length > 50) GameState.logs[type].shift();
            
            const activeTab = document.querySelector('.log-tab.active');
            if (activeTab && activeTab.dataset.type === type) {
                updateLogDisplay(type);
            }
        }

        function updateLogDisplay(type) {
            const display = document.getElementById('log-display');
            if (!display) return;
            const filter = document.getElementById('log-filter-input').value.toLowerCase();
            const filteredLogs = GameState.logs[type].filter(log => log.toLowerCase().includes(filter));
            display.innerHTML = filteredLogs.join('<br>');
            display.scrollTop = display.scrollHeight;
        }

        function switchLogTab(type) {
            document.querySelectorAll('.log-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.type === type);
            });
            updateLogDisplay(type);
        }

        // --- 勝負判定邏輯 ---
        function checkWinConditions() {
            if (!GameState.gameActive) return;
            
            const le = GameState.playerData.law_enforcement;
            const hacker = GameState.playerData.hacker;
            const timeLeft = GameState.gameTimeLimit - (Math.floor((Date.now() - GameState.gameStartTime) / 1000));

            // 執法部門勝利條件
            if (le.identityLock.physical >= 100) {
                endGameWithAnimation('law_enforcement', '實體定位完成：黑客已被現場逮捕。');
                return;
            }
            
            if (timeLeft <= 0) {
                if (le.serverHealth > 0 && le.evidenceLibraryHealth > 0) {
                    endGameWithAnimation('law_enforcement', '系統防禦成功：黑客未能癱瘓核心系統，行動時間已過。');
                } else {
                    endGameWithAnimation('hacker', '任務超時：雖然系統受損，但黑客成功逃脫。');
                }
                return;
            }

            // 黑客勝利條件
            if (le.serverHealth <= 0 || le.evidenceLibraryHealth <= 0) {
                endGameWithAnimation('hacker', '核心系統癱瘓：執法部門指揮中心/證據庫已被徹底破壞。');
                return;
            }
            
            // 黑客完美逃脫 (隱蔽度極高且足跡為0)
            if (hacker.stealth >= 95 && hacker.digitalFootprints === 0 && timeLeft < 300) {
                endGameWithAnimation('hacker', '完美犯罪：黑客已徹底消滅所有網絡痕跡，執法部門無法追蹤。');
                return;
            }
        }

        function endGameWithAnimation(winner, reason) {
            GameState.gameActive = false;
            clearInterval(GameState.gameTimer);
            
            const overlay = document.getElementById('game-result-animation');
            const animContent = document.getElementById('victory-animation-content');
            const reportContent = document.getElementById('victory-report-content');
            
            overlay.style.display = 'flex';
            
            if (winner === 'law_enforcement') {
                animContent.innerHTML = `<h1 style="color:#4a90d9; font-size:3rem; text-shadow:0 0 20px #4a90d9;">案件已結案</h1>
                                         <div style="font-size:1.5rem; margin-top:10px;">CASE CLOSED</div>
                                         <i class="fas fa-gavel" style="font-size:5rem; margin-top:20px; color:#4a90d9;"></i>`;
                reportContent.innerHTML = `
                    <h3>執法行動報告</h3>
                    <p><strong>結案原因:</strong> ${reason}</p>
                    <p><strong>逮捕對象:</strong> 匿名黑客 (IP: ${GameState.opponentIP})</p>
                    <p><strong>證據鏈完整度:</strong> ${GameState.playerData.law_enforcement.evidenceChain.length * 10}%</p>
                    <p><strong>定罪摘要:</strong> 根據《網絡安全法》，嫌疑人涉嫌非法入侵政府系統、竊取機密數據及破壞公共設施。現場搜獲多台加密伺服器及物理證據。</p>
                `;
            } else {
                animContent.innerHTML = `<h1 style="color:#00ff41; font-size:3rem; text-shadow:0 0 20px #00ff41;">任務成功</h1>
                                         <div style="font-size:1.5rem; margin-top:10px;">MISSION ACCOMPLISHED</div>
                                         <i class="fas fa-skull-crossbones" style="font-size:5rem; margin-top:20px; color:#00ff41;"></i>`;
                reportContent.innerHTML = `
                    <h3>黑客行動總結</h3>
                    <p><strong>成果:</strong> ${reason}</p>
                    <p><strong>目標狀態:</strong> ${GameState.playerData.law_enforcement.serverHealth <= 0 ? '徹底癱瘓' : '數據外洩'}</p>
                    <p><strong>暗網交易:</strong> 已確認。資金已轉入加密匿名錢包。</p>
                    <p><strong>痕跡清理:</strong> ${GameState.playerData.hacker.digitalFootprints === 0 ? '完美清理' : '部分殘留'}</p>
                `;
            }
        }
    
        function initializeGameUI() {
            // 驗證遊戲數據
            validateGameStats();
            
            const gamePage = document.getElementById('game-page');
            gamePage.innerHTML = '';
            
            // 根據角色確定UI主題
            const uiClass = GameState.currentRole === 'hacker' ? 'hacker-ui' : 'law-enforcement-ui';
            const primaryColor = GameState.currentRole === 'hacker' ? '#00ff41' : '#4a90d9';
            const roleName = GameState.currentRole === 'hacker' ? '黑客' : '執法部門';
            const opponentName = GameState.currentRole === 'hacker' ? '執法部門' : '黑客';
            
            // 構建遊戲界面
            gamePage.className = 'page active ' + uiClass;
            gamePage.innerHTML = `
                <div class="game-container">
                    <!-- 遊戲頭部 -->
                    <div class="game-header">
                        <div class="game-title-container">
                            <div class="game-mode-icon">
                                <i class="fas ${GameState.currentRole === 'hacker' ? 'fa-user-secret' : 'fa-shield-alt'}"></i>
                            </div>
                            <div class="game-title">${roleName} • 對戰模式第二季</div>
                        </div>
                        
                        <div class="connection-status">
                            <div class="status-indicator ${GameState.connectionStatus === 'connected' ? '' : 'disconnected'}"></div>
                            <span>${GameState.connectionStatus === 'connected' ? '已連接' : '未連接'}</span>
                        </div>
                        
                        <div class="target-info">
                            <div class="target-label">目標</div>
                            <div class="target-ip">${GameState.opponentIP} (${opponentName})</div>
                        </div>
                    </div>
                    
                    <!-- 截圖風格的目標系統信息 -->
                    <div class="target-system-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="color: ${primaryColor}; font-weight: bold; font-size: 1.1rem;">目標信息</div>
                                <div style="color: #aaa; font-size: 0.9rem;">${GameState.currentRole === 'hacker' ? '執法部門指揮中心' : '黑客網絡系統'}</div>
                            </div>
                            <div style="padding: 5px 10px; background: rgba(0,255,65,0.2); border-radius: 12px; color: #00ff41; font-size: 0.8rem;">
                                在線
                            </div>
                        </div>
                        
                        <div class="system-details" id="system-details">
                            <!-- 系統詳細信息將由JavaScript動態生成 -->
                        </div>
                    </div>
                    
                    <!-- 攻擊路徑視覺化 -->
                    <div class="attack-path-visualization">
                        <div class="path-title">
                            <i class="fas fa-project-diagram"></i>
                            <span>攻擊路徑視覺化</span>
                        </div>
                        <div class="path-timeline" id="attack-path-timeline">
                            <!-- 攻擊路徑時間線將由JavaScript動態生成 -->
                        </div>
                    </div>
                    
                    <!-- 遊戲統計 -->
                    <div class="game-stats" id="game-stats">
                        <!-- 統計卡片將由JavaScript動態生成 -->
                    </div>
                    
                    <!-- 系統狀態條 -->
                    <div class="system-status-bars" id="system-status-bars">
                        <!-- 系統狀態條將由JavaScript動態生成 -->
                    </div>
                    
                    <!-- 主遊戲區域 -->
                    <div class="game-main">
                        <!-- 左側面板 -->
                        <div class="left-panel">
                            <!-- 終端機 -->
                            <div class="terminal-container">
                                <div class="terminal-header">
                                    <div class="terminal-title">
                                        <i class="fas fa-terminal"></i>
                                        <span>${GameState.currentRole === 'hacker' ? 'DARKNET TERMINAL v4.0' : 'LAW ENFORCEMENT COMMAND v3.0'}</span>
                                    </div>
                                    <div class="terminal-status">
                                        <i class="fas fa-clock"></i>
                                        <span id="game-timer">${Math.floor(GameState.gameTimeLimit / 60).toString().padStart(2, '0')}:00</span>
                                    </div>
                                </div>
                                <div class="terminal-body">
                                    <div class="terminal-output" id="terminal-output"></div>
                                    <div class="terminal-input-container">
                                        <div class="terminal-prompt">${GameState.currentRole === 'hacker' ? 'root@shadow:~#' : 'investigator@le:~#'}</div>
                                        <input type="text" class="terminal-input" id="terminal-input" placeholder="輸入指令或使用工具...">
                                    </div>
                                    <div class="input-suggestions" id="input-suggestions">
                                        <!-- 輸入建議將由JavaScript動態生成 -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 工具面板 -->
                            <div class="tools-panel">
                                <div class="tools-title">
                                    <i class="fas fa-tools"></i>
                                    <span>專屬工具庫</span>
                                </div>
                                <div class="tools-categories" id="tool-categories">
                                    <!-- 工具分類將由JavaScript動態生成 -->
                                </div>
                                <div class="tools-grid" id="tools-grid">
                                    <!-- 工具將由JavaScript動態生成 -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右側面板 -->
                        <div class="right-panel">
                            <!-- 任務目標面板 -->
                            <div class="mission-panel">
                                <div class="mission-title">
                                    <i class="fas fa-bullseye"></i>
                                    <span>任務目標</span>
                                </div>
                                <div class="mission-list" id="mission-list">
                                    <!-- 任務列表將由JavaScript動態生成 -->
                                </div>
                            </div>
                            
                            <!-- 攻擊/防禦視覺化 -->
                            <div class="attack-defense-visualization">
                                <div class="visualization-title">
                                    <i class="fas fa-chart-line"></i>
                                    <span>對抗狀態</span>
                                </div>
                                <div class="progress-bars" id="attack-defense-bars">
                                    <!-- 進度條將由JavaScript動態生成 -->
                                </div>
                            </div>
                            
                            <!-- 系統健康視覺化 -->
                            <div class="health-visualization" id="health-visualization">
                                <!-- 健康卡片將由JavaScript動態生成 -->
                            </div>
                            
                            <!-- 對戰信息面板 -->
                            <div class="battle-info">
                                <div class="battle-title">
                                    <i class="fas fa-info-circle"></i>
                                    <span>對戰信息</span>
                                </div>
                                
                                <!-- 實時目標信息顯示 -->
                                <div class="target-realtime-info" id="target-realtime-info">
                                    <!-- 實時目標信息將由JavaScript動態生成 -->
                                </div>
                                
                                <div id="special-panel">
        <div class="network-topology">
            <div class="tools-title"><i class="fas fa-project-diagram"></i> 網絡可視化面板</div>
            <div id="network-topology-container" style="position:relative; width:100%; height:210px;"></div>
        </div>
        <div class="log-monitor">
            <div class="log-tabs">
                <div class="log-tab active" data-type="system" onclick="switchLogTab('system')">系統日誌</div>
                <div class="log-tab" data-type="security" onclick="switchLogTab('security')">安全日誌</div>
                <div class="log-tab" data-type="communication" onclick="switchLogTab('communication')">通信日誌</div>
            </div>
            <div id="log-display" class="log-display"></div>
            <div class="log-filter">
                <input type="text" id="log-filter-input" placeholder="過濾關鍵詞..." oninput="updateLogDisplay(document.querySelector('.log-tab.active').dataset.type)">
            </div>
        </div>
    
                                    <!-- 特殊面板將根據角色顯示 -->
                                </div>
                            </div>
                            
                            <!-- 控制面板 -->
                            <div class="game-controls">
                                <div class="control-group">
                                    <button class="btn btn-primary" onclick="connectToTarget()">
                                        <i class="fas fa-plug"></i>
                                        <span>連接目標</span>
                                    </button>
                                    <button class="btn btn-secondary" onclick="disconnectFromTarget()">
                                        <i class="fas fa-plug"></i>
                                        <span>斷開連接</span>
                                    </button>
                                    ${GameState.currentRole === 'hacker' ? 
                                        '<button class="btn btn-warning" onclick="openHackerShop()"><i class="fas fa-shopping-cart"></i><span>黑客商店</span></button>' :
                                        '<button class="btn btn-warning" onclick="openLEShop()"><i class="fas fa-shopping-cart"></i><span>執法商店</span></button>'
                                    }
                                </div>
                                <div class="control-group">
                                    <button class="btn btn-warning" onclick="pauseGame()">
                                        <i class="fas fa-pause"></i>
                                        <span>暫停遊戲</span>
                                    </button>
                                    <button class="btn back-btn" onclick="goToMainPage()">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>退出對戰</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 初始化遊戲UI組件
            updateSystemDetails();
            updateAttackPathTimeline();
            updateGameStats(); checkWinConditions(); updateReputation(); triggerRandomEvent(); updateResourceUI(); if(GameState.gameActive && Math.random() < 0.1) addGameLog("system", "背景流量監控中...");
            updateSystemStatusBars();
            updateMissionList();
            updateAttackDefenseBars();
            updateHealthVisualization();
            updateTargetRealtimeInfo();
            updateToolCategories();
            updateToolsGrid(GameState.currentRole === 'hacker' ? 'reconnaissance' : 'investigation');
            updateSpecialPanel();
            
            // 設置終端輸入事件
            const terminalInput = document.getElementById('terminal-input');
            if (terminalInput) {
                terminalInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const command = this.value.trim();
                        if (command) {
                            executeCommand(command);
                            this.value = '';
                        }
                    }
                });
            }
        }

        // ===== 系統詳細信息更新 =====
        function updateSystemDetails() {
            const detailsContainer = document.getElementById('system-details');
            if (!detailsContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const hacker = GameState.playerData.hacker;
                detailsContainer.innerHTML = `
                    <div class="system-detail">
                        <div class="system-label">你的ID</div>
                        <div class="system-value">${GameState.playerIP}</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">目標ID</div>
                        <div class="system-value">${GameState.opponentIP}</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">隱蔽等級</div>
                        <div class="system-value">${hacker.stealth}%</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">加密等級</div>
                        <div class="system-value">${hacker.encryptionLevel}%</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">VPN節點</div>
                        <div class="system-value">${hacker.activeVpnNodes}</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">數碼足跡</div>
                        <div class="system-value">${hacker.digitalFootprints}</div>
                    </div>
                `;
            } else {
                const le = GameState.playerData.law_enforcement;
                detailsContainer.innerHTML = `
                    <div class="system-detail">
                        <div class="system-label">你的ID</div>
                        <div class="system-value">${GameState.playerIP}</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">目標ID</div>
                        <div class="system-value">${GameState.opponentIP}</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">調查進度</div>
                        <div class="system-value">${le.investigationProgress}%</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">身份鎖定</div>
                        <div class="system-value">${Math.round((le.identityLock.technical + le.identityLock.social + le.identityLock.physical) / 3)}%</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">關鍵證據</div>
                        <div class="system-value">${le.criticalEvidence.length}/3</div>
                    </div>
                    <div class="system-detail">
                        <div class="system-label">待驗證情報</div>
                        <div class="system-value">${le.dynamicIntel.length}</div>
                    </div>
                `;
            }
        }

        // ===== 攻擊路徑時間線更新 =====
        function updateAttackPathTimeline() {
            const timelineContainer = document.getElementById('attack-path-timeline');
            if (!timelineContainer) return;
            
            // 模擬攻擊路徑事件
            const now = new Date();
            const events = [
                { time: `${now.getHours().toString().padStart(2, '0')}:${(now.getMinutes()-2).toString().padStart(2, '0')}`, action: '初始連接建立' },
                { time: `${now.getHours().toString().padStart(2, '0')}:${(now.getMinutes()-1).toString().padStart(2, '0')}`, action: '端口掃描完成' },
                { time: `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`, action: '漏洞評估進行中' }
            ];
            
            timelineContainer.innerHTML = '';
            events.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'path-event';
                eventElement.innerHTML = `
                    <div class="path-time">${event.time}</div>
                    <div class="path-action">${event.action}</div>
                `;
                timelineContainer.appendChild(eventElement);
            });
        }

        // ===== 遊戲統計更新 =====
        function updateGameStats() {
            const statsContainer = document.getElementById('game-stats');
            if (!statsContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const hacker = GameState.playerData.hacker;
                statsContainer.innerHTML = `
                    
        <div class="stat-card">
            <div class="stat-label">資源點數 <span class="reputation-badge" id="reputation-display">聲譽: 0</span></div>
            <div class="resource-bar"><div id="${GameState.currentRole}-resource-fill" class="resource-fill" style="width:100%"></div></div>
        </div>
    
                    <div class="stat-card">
                        <div class="stat-label">資金</div>
                        <div class="stat-value">$${hacker.money.toLocaleString()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">隱蔽度</div>
                        <div class="stat-value">${hacker.stealth}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">數碼足跡</div>
                        <div class="stat-value">${hacker.digitalFootprints}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">入侵設備</div>
                        <div class="stat-value">${hacker.compromisedDevices.length}</div>
                    </div>
                `;
            } else {
                const le = GameState.playerData.law_enforcement;
                const identityAvg = Math.round((le.identityLock.technical + le.identityLock.social + le.identityLock.physical) / 3);
                
                statsContainer.innerHTML = `
                    <div class="evidence-stat">
                        <div class="evidence-label">調查預算</div>
                        <div class="evidence-value">$${le.budget.toLocaleString()}</div>
                    </div>
                    <div class="evidence-stat">
                        <div class="evidence-label">身份鎖定</div>
                        <div class="evidence-value">${identityAvg}%</div>
                    </div>
                    <div class="evidence-stat">
                        <div class="evidence-label">關鍵證據</div>
                        <div class="evidence-value">${le.criticalEvidence.length}</div>
                    </div>
                    <div class="evidence-stat">
                        <div class="evidence-label">伺服器健康</div>
                        <div class="evidence-value">${le.serverHealth}%</div>
                    </div>
                `;
            }
        }

        // ===== 系統狀態條更新 =====
        function updateSystemStatusBars() {
            const statusBarsContainer = document.getElementById('system-status-bars');
            if (!statusBarsContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const hacker = GameState.playerData.hacker;
                statusBarsContainer.innerHTML = `
                    <div class="status-bar">
                        <div class="status-label">攻擊路徑</div>
                        <div class="status-value">7.5%</div>
                        <div class="status-percentage">進度</div>
                    </div>
                    <div class="status-bar">
                        <div class="status-label">加密等級</div>
                        <div class="status-value">${hacker.encryptionLevel}%</div>
                        <div class="status-percentage">強度</div>
                    </div>
                    <div class="status-bar">
                        <div class="status-label">檢測風險</div>
                        <div class="status-value">${100 - hacker.stealth}%</div>
                        <div class="status-percentage">風險</div>
                    </div>
                `;
            } else {
                const le = GameState.playerData.law_enforcement;
                statusBarsContainer.innerHTML = `
                    <div class="status-bar">
                        <div class="status-label">調查進度</div>
                        <div class="status-value">${le.investigationProgress}%</div>
                        <div class="status-percentage">進度</div>
                    </div>
                    <div class="status-bar">
                        <div class="status-label">證據質量</div>
                        <div class="status-value">${le.evidenceChain.length > 0 ? Math.min(100, le.evidenceChain.filter(e => !e.contaminated).length * 20) : 0}%</div>
                        <div class="status-percentage">質量</div>
                    </div>
                    <div class="status-bar">
                        <div class="status-label">系統防護</div>
                        <div class="status-value">${Math.round((le.serverHealth + le.evidenceLibraryHealth + le.analysisToolsHealth) / 3)}%</div>
                        <div class="status-percentage">防護</div>
                    </div>
                `;
            }
        }

        // ===== 任務列表更新 =====
        function updateMissionList() {
            const missionListContainer = document.getElementById('mission-list');
            if (!missionListContainer) return;
            
            const missions = GameState.missions[GameState.currentRole];
            missionListContainer.innerHTML = '';
            
            missions.forEach(mission => {
                const missionElement = document.createElement('div');
                missionElement.className = 'mission-item';
                missionElement.innerHTML = `
                    <div class="mission-name">${mission.name}</div>
                    <div class="mission-status ${mission.status === 'complete' ? 'mission-complete' : 'mission-incomplete'}">
                        ${mission.status === 'complete' ? '完成' : '進行中'}
                    </div>
                `;
                missionListContainer.appendChild(missionElement);
            });
        }

        // ===== 攻擊/防禦進度條更新 =====
        function updateAttackDefenseBars() {
            const barsContainer = document.getElementById('attack-defense-bars');
            if (!barsContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const hacker = GameState.playerData.hacker;
                const opponent = GameState.opponentData.law_enforcement;
                
                barsContainer.innerHTML = `
                    <div class="progress-item">
                        <div class="progress-label">攻擊強度</div>
                        <div class="progress-container">
                            <div class="progress-fill attack-progress" style="width: ${hacker.attackPower}%">${hacker.attackPower}%</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">隱蔽等級</div>
                        <div class="progress-container">
                            <div class="progress-fill stealth-progress" style="width: ${hacker.stealth}%">${hacker.stealth}%</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">調查壓力</div>
                        <div class="progress-container">
                            <div class="progress-fill defense-progress" style="width: ${opponent.investigationProgress}%">${opponent.investigationProgress}%</div>
                        </div>
                    </div>
                `;
            } else {
                const le = GameState.playerData.law_enforcement;
                const opponent = GameState.opponentData.hacker;
                
                barsContainer.innerHTML = `
                    <div class="progress-item">
                        <div class="progress-label">調查進度</div>
                        <div class="progress-container">
                            <div class="progress-fill attack-progress" style="width: ${le.investigationProgress}%">${le.investigationProgress}%</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">系統防護</div>
                        <div class="progress-container">
                            <div class="progress-fill defense-progress" style="width: ${Math.round((le.serverHealth + le.evidenceLibraryHealth) / 2)}%">${Math.round((le.serverHealth + le.evidenceLibraryHealth) / 2)}%</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">黑客隱蔽</div>
                        <div class="progress-container">
                            <div class="progress-fill stealth-progress" style="width: ${opponent.stealth}%">${opponent.stealth}%</div>
                        </div>
                    </div>
                `;
            }
        }

        // ===== 健康視覺化更新 =====
        function updateHealthVisualization() {
            const healthContainer = document.getElementById('health-visualization');
            if (!healthContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const hacker = GameState.playerData.hacker;
                
                // 確定健康等級
                const getHealthClass = (value) => {
                    if (value >= 70) return 'high';
                    if (value >= 40) return 'medium';
                    return 'low';
                };
                
                healthContainer.innerHTML = `
                    <div class="health-card ${getHealthClass(hacker.serverHealth)}">
                        <div class="health-card-title">主伺服器</div>
                        <div class="health-card-value">${hacker.serverHealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(hacker.deviceHealth)}">
                        <div class="health-card-title">設備健康</div>
                        <div class="health-card-value">${hacker.deviceHealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(hacker.stealth)}">
                        <div class="health-card-title">隱蔽系統</div>
                        <div class="health-card-value">${hacker.stealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(hacker.encryptionLevel)}">
                        <div class="health-card-title">加密系統</div>
                        <div class="health-card-value">${hacker.encryptionLevel}%</div>
                    </div>
                `;
            } else {
                const le = GameState.playerData.law_enforcement;
                
                // 確定健康等級
                const getHealthClass = (value) => {
                    if (value >= 70) return 'high';
                    if (value >= 40) return 'medium';
                    return 'low';
                };
                
                healthContainer.innerHTML = `
                    <div class="health-card ${getHealthClass(le.serverHealth)}">
                        <div class="health-card-title">指揮中心</div>
                        <div class="health-card-value">${le.serverHealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(le.evidenceLibraryHealth)}">
                        <div class="health-card-title">證據庫</div>
                        <div class="health-card-value">${le.evidenceLibraryHealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(le.analysisToolsHealth)}">
                        <div class="health-card-title">分析工具</div>
                        <div class="health-card-value">${le.analysisToolsHealth}%</div>
                    </div>
                    <div class="health-card ${getHealthClass(Math.round((le.identityLock.technical + le.identityLock.social + le.identityLock.physical) / 3))}">
                        <div class="health-card-title">身份鎖定</div>
                        <div class="health-card-value">${Math.round((le.identityLock.technical + le.identityLock.social + le.identityLock.physical) / 3)}%</div>
                    </div>
                `;
            }
        }

        // ===== 實時目標信息更新 =====
        function updateTargetRealtimeInfo() {
            const realtimeInfoContainer = document.getElementById('target-realtime-info');
            if (!realtimeInfoContainer) return;
            
            if (GameState.currentRole === 'hacker') {
                const opponent = GameState.opponentData.law_enforcement;
                const identityAvg = Math.round((opponent.identityLock.technical + opponent.identityLock.social + opponent.identityLock.physical) / 3);
                
                realtimeInfoContainer.innerHTML = `
                    <div class="realtime-title">
                        <div class="realtime-name">執法部門指揮中心</div>
                        <div class="realtime-status">在線</div>
                    </div>
                    <div class="realtime-details">
                        <div class="realtime-detail">
                            <div class="realtime-label">調查預算</div>
                            <div class="realtime-value">$${(opponent.budget/1000).toFixed(0)}K</div>
                        </div>
                        <div class="realtime-detail">
                            <div class="realtime-label">身份鎖定</div>
                            <div class="realtime-value">${identityAvg}%</div>
                        </div>
                        <div class="realtime-detail">
                            <div class="realtime-label">伺服器健康</div>
                            <div class="realtime-value">${opponent.serverHealth}%</div>
                        </div>
                    </div>
                `;
            } else {
                const opponent = GameState.opponentData.hacker;
                
                realtimeInfoContainer.innerHTML = `
                    <div class="realtime-title">
                        <div class="realtime-name">黑客網絡系統</div>
                        <div class="realtime-status">在線</div>
                    </div>
                    <div class="realtime-details">
                        <div class="realtime-detail">
                            <div class="realtime-label">隱蔽等級</div>
                            <div class="realtime-value">${opponent.stealth}%</div>
                        </div>
                        <div class="realtime-detail">
                            <div class="realtime-label">VPN節點</div>
                            <div class="realtime-value">${opponent.activeVpnNodes}</div>
                        </div>
                        <div class="realtime-detail">
                            <div class="realtime-label">數碼足跡</div>
                            <div class="realtime-value">${opponent.digitalFootprints}</div>
                        </div>
                    </div>
                `;
            }
        }

        // ===== 工具系統 =====
        function updateToolCategories() {
            const categoriesContainer = document.getElementById('tool-categories');
            if (!categoriesContainer) return;
            
            const toolCategories = GameState.currentRole === 'hacker' 
                ? ['reconnaissance', 'stealth', 'counter_investigation', 'attack', 'infiltration', 'server_management', 'advanced']
                : ['investigation', 'tracking', 'defense', 'collaboration', 'forensics', 'skills', 'decryption', 'server_management', 'attack'];
            
            const categoryNames = {
                reconnaissance: { name: '偵察工具', icon: 'fa-binoculars' },
                stealth: { name: '隱蔽工具', icon: 'fa-mask' },
                counter_investigation: { name: '反制調查', icon: 'fa-virus-slash' },
                attack: { name: '攻擊工具', icon: 'fa-crosshairs' },
                infiltration: { name: '入侵工具', icon: 'fa-user-ninja' },
                advanced: { name: '高級工具', icon: 'fa-cogs' },
                investigation: { name: '調查工具', icon: 'fa-search' },
                tracking: { name: '追蹤工具', icon: 'fa-map-marker-alt' },
                defense: { name: '防禦工具', icon: 'fa-shield-alt' },
                collaboration: { name: '協作工具', icon: 'fa-users-cog' },
                forensics: { name: '數位鑑識', icon: 'fa-certificate' },
                skills: { name: '技能與裝備', icon: 'fa-graduation-cap' },
                decryption: { name: '解密工具', icon: 'fa-unlock-alt' },
                server_management: { name: '伺服器管理', icon: 'fa-server' }
            };
            
            categoriesContainer.innerHTML = '';
            toolCategories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.innerHTML = `<i class="fas ${categoryNames[category].icon}"></i> ${categoryNames[category].name}`;
                btn.onclick = () => updateToolsGrid(category);
                if (category === 'reconnaissance' || category === 'investigation') {
                    btn.classList.add('active');
                }
                categoriesContainer.appendChild(btn);
            });
        }

        function updateToolsGrid(category) {
            const toolsGrid = document.getElementById('tools-grid');
            if (!toolsGrid) return;
            
            const tools = GameState.tools[GameState.currentRole][category];
            if (!tools) return;
            
            toolsGrid.innerHTML = '';
            tools.forEach(tool => {
                const toolCard = document.createElement('div');
                toolCard.className = 'tool-card';
                toolCard.innerHTML = `
                    <div class="tool-icon"><i class="fas ${tool.icon || 'fa-cog'}"></i></div>
                    <div class="tool-name">${tool.name}</div>
                    <div class="tool-desc">${tool.desc}</div>
                    <div class="tool-cooldown">冷卻: ${tool.cooldown}秒 | 費用: $${tool.cost}</div>
                `;
                toolCard.onclick = () => useTool(tool.id, tool);
                toolsGrid.appendChild(toolCard);
            });
        }

        // ===== 工具使用函數 =====
        function useTool(toolId, toolData) {
            if (!GameState.gameActive) return;
            showNotification('工具已激活', '工具「' + toolData.name + '」正在執行...', 'success');
            addTerminalLine('[執行] 啟動工具: ' + toolData.name, 'command');
            addTerminalLine('[結果] 工具執行成功，冷卻時間: ' + toolData.cooldown + '秒', 'success');
        }

        // ===== 遊戲更新循環 =====
        function updateGameLoop() {
            if (!GameState.gameActive) return;
            validateGameStats();
            checkWinConditions();
            updateReputation();
            triggerRandomEvent();
            updateResourceUI();
        }

        // ===== 遊戲計時器 =====
        function startGameTimer() {
            let timeLeft = GameState.gameTimeLimit;
            GameState.gameTimer = setInterval(() => {
                if (!GameState.gameActive) {
                    clearInterval(GameState.gameTimer);
                    return;
                }
                
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const timerEl = document.getElementById('game-timer');
                if (timerEl) {
                    timerEl.textContent = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                }
                
                if (timeLeft <= 0) {
                    GameState.gameActive = false;
                    clearInterval(GameState.gameTimer);
                    checkWinConditions();
                }
                
                updateGameLoop();
            }, 1000);
        }

        // ===== 終端命令執行 =====
        function executeCommand(command) {
            addTerminalLine('$ ' + command, 'command');
            if (command.toLowerCase() === 'help') {
                addTerminalLine('可用指令: scan, attack, defend, status, tools', 'response');
            } else if (command.toLowerCase() === 'status') {
                updateGameStats();
                addTerminalLine('[狀態] 遊戲數據已更新', 'success');
            } else {
                addTerminalLine('[系統] 指令未識別，輸入 help 查看可用指令', 'error');
            }
        }

        // ===== 連接/斷開目標 =====
        function connectToTarget() {
            GameState.connectionStatus = 'connected';
            addTerminalLine('[系統] 已連接到目標: ' + GameState.opponentIP, 'success');
            showNotification('連接成功', '已連接到對手系統', 'success');
        }

        function disconnectFromTarget() {
            GameState.connectionStatus = 'disconnected';
            addTerminalLine('[系統] 已斷開連接', 'warning');
            showNotification('連接已斷開', '已斷開與對手系統的連接', 'warning');
        }

        // ===== 商店相關函數 =====
        function openHackerShop() {
            showNotification('黑客商店', '黑客專用工具商店已開啟', 'hacker');
            openShop();
        }

        function openLEShop() {
            showNotification('執法商店', '執法部門專用工具商店已開啟', 'law_enforcement');
            openShop();
        }

        function openShop() {
            const shopModal = document.getElementById('shop-modal');
            if (!shopModal) return;
            const role = GameState.currentRole;
            const shopItems = GameState.playerData[role === 'hacker' ? 'hacker' : 'law_enforcement'].shopItems;
            let html = '<div style="max-height: 400px; overflow-y: auto;">';
            shopItems.forEach(item => {
                html += `<div style="padding: 10px; border: 1px solid #333; margin: 5px 0; border-radius: 4px;">
                    <strong>${item.name}</strong> - $${item.price}<br>
                    <small>${item.effect}</small><br>
                    <button class="btn btn-primary" onclick="buyItem('${item.id}', ${item.price})" style="margin-top: 5px;">購買</button>
                </div>`;
            });
            html += '</div>';
            document.getElementById('shop-message').innerHTML = html;
            shopModal.classList.add('active');
        }

        function buyItem(itemId, price) {
            const role = GameState.currentRole;
            const player = GameState.playerData[role === 'hacker' ? 'hacker' : 'law_enforcement'];
            const budget = role === 'hacker' ? 'money' : 'budget';
            
            if (player[budget] >= price) {
                player[budget] -= price;
                addTerminalLine('[購買] 已購買物品ID: ' + itemId, 'success');
                showNotification('購買成功', '物品已添加到你的背包', 'success');
                updateGameStats();
            } else {
                showNotification('資金不足', '你的資金不足以購買此物品', 'warning');
            }
        }

        function openTransactionHistory() {
            const historyModal = document.getElementById('history-modal');
            if (!historyModal) return;
            let html = '<div style="max-height: 400px; overflow-y: auto;">';
            if (GameState.transactionHistory.length === 0) {
                html += '<p>暫無交易記錄</p>';
            } else {
                GameState.transactionHistory.forEach(trans => {
                    html += `<div style="padding: 10px; border-bottom: 1px solid #333;">
                        <strong>${trans.type}</strong> - ${trans.amount}<br>
                        <small>${trans.time}</small>
                    </div>`;
                });
            }
            html += '</div>';
            document.getElementById('history-message').innerHTML = html;
            historyModal.classList.add('active');
        }

        // ===== 暫停遊戲 =====
        function pauseGame() {
            GameState.gameActive = false;
            showNotification('遊戲已暫停', '遊戲已暫停，點擊恢復按鈕繼續', 'warning');
        }

        // ===== 顯示操作指南 =====
        function showGuide() {
            showNotification('操作指南', '第二季對戰使用終端輸入指令或點擊工具執行操作。每個工具都有冷卻時間，請合理安排戰術。', 'info');
        }

        // ===== 初始化函數（缺失的） =====
        function initializeSkillTree() {
            addGameLog('system', '技能樹系統已初始化');
        }

        function initializeEquipmentSystem() {
            addGameLog('system', '裝備系統已初始化');
        }

        function initializeAutoSave() {
            GameState.autoSaveInterval = setInterval(() => {
                localStorage.setItem('gameState', JSON.stringify(GameState));
                GameState.lastSaveTime = new Date();
            }, 30000);
        }

        function initializeEvidenceIntegrity() {
            addGameLog('system', '證據完整性驗證系統已初始化');
        }

        // ===== 動態情報生成 =====
        function generateDynamicIntel() {
            const le = GameState.playerData.law_enforcement;
            for (let i = 0; i < 5; i++) {
                const intelTypes = GameState.intelTypes;
                const randomIntel = intelTypes[Math.floor(Math.random() * intelTypes.length)];
                le.dynamicIntel.push(randomIntel);
            }
            addGameLog('system', '動態情報已生成');
        }

        // ===== 更新特殊面板 =====
        function updateSpecialPanel() {
            const specialPanel = document.getElementById('special-panel');
            if (!specialPanel) return;
            
            if (GameState.currentRole === 'hacker') {
                specialPanel.innerHTML = '<div style="color: #00ff41; padding: 10px;">黑客專用面板 - 隱蔽度/足跡管理</div>';
            } else {
                specialPanel.innerHTML = '<div style="color: #4a90d9; padding: 10px;">執法部門專用面板 - 證據/身份鎖定</div>';
            }
        }
    </script>
</body>
</html>